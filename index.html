<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Briefcase</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f8f9fa; 
            color: #333; 
        }
        .container { 
            max-width: 400px; 
            margin: 0 auto; 
            background: white; 
            min-height: 100vh; 
        }
        .header { 
            background: #dc2626; 
            color: white; 
            padding: 16px; 
            position: sticky; 
            top: 0; 
            z-index: 10; 
        }
        .header-top { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 8px; 
        }
        .header-left {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            flex: 1;
        }
        .logo {
            width: 280px;
            height: 80px;
            flex-shrink: 0;
        }
        .logo svg {
            width: 100%;
            height: 100%;
        }
        .header-right {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .title { 
            font-size: 18px; 
            font-weight: bold; 
        }
        .score { 
            background: #991b1b; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 14px; 
        }
        .timer {
            background: #fef2f2;
            color: #dc2626;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .header-info { 
            font-size: 12px; 
            display: flex; 
            gap: 8px; 
            align-items: center; 
            flex-wrap: wrap;
        }
        .urgency { 
            padding: 3px 6px; 
            border-radius: 10px; 
            font-size: 11px; 
        }
        .urgency.high { 
            background: #fef2f2; 
            color: #dc2626; 
        }
        .urgency.medium { 
            background: #fefce8; 
            color: #ca8a04; 
        }
        .urgency.low { 
            background: #f0fdf4; 
            color: #16a34a; 
        }
        .content { 
            padding: 16px; 
        }
        .stats-panel {
            background: #f9fafb;
            padding: 14px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #e5e7eb;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }
        .stat-item {
            text-align: center;
            padding: 10px 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #dc2626;
        }
        .stat-label {
            font-size: 11px;
            color: #6b7280;
            margin-top: 2px;
        }
        .category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 16px;
        }
        .filter-chip {
            padding: 6px 10px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid #e5e7eb;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        .filter-chip.active {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }
        .reset-stats {
            background: #ef4444;
            color: white;
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            margin-top: 8px;
            font-weight: 500;
        }
        .reset-stats:hover {
            background: #dc2626;
        }
        .case-header { 
            margin-bottom: 16px; 
        }
        .case-title { 
            font-size: 16px; 
            font-weight: 600; 
            margin-bottom: 8px; 
        }
        .presentation { 
            background: #f9fafb; 
            padding: 12px; 
            border-radius: 8px; 
            margin-bottom: 12px; 
            font-size: 14px; 
            line-height: 1.4; 
        }
        .vitals { 
            background: #eff6ff; 
            padding: 12px; 
            border-radius: 8px; 
        }
        .vitals-label { 
            font-size: 11px; 
            font-weight: 600; 
            color: #1e40af; 
            margin-bottom: 4px; 
        }
        .vitals-text { 
            font-size: 13px; 
            color: #1e40af; 
        }
        .progress { 
            display: flex; 
            gap: 6px; 
            margin-bottom: 16px; 
        }
        .progress-bar { 
            height: 6px; 
            flex: 1; 
            border-radius: 3px; 
            background: #e5e7eb; 
        }
        .progress-bar.active { 
            background: #dc2626; 
        }
        .question { 
            margin-bottom: 16px; 
        }
        .question-title { 
            font-weight: 500; 
            margin-bottom: 12px; 
            font-size: 15px;
        }
        .options { 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
        }
        .option { 
            width: 100%; 
            padding: 12px; 
            text-align: left; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            background: white; 
            cursor: pointer; 
            transition: all 0.2s; 
            font-size: 14px; 
            min-height: 44px;
            display: flex;
            align-items: center;
        }
        .option:hover:not(:disabled) { 
            background: #fef2f2; 
            border-color: #dc2626; 
        }
        .option.correct { 
            background: #f0fdf4; 
            border-color: #16a34a; 
            color: #15803d; 
        }
        .option.incorrect { 
            background: #fef2f2; 
            border-color: #dc2626; 
            color: #dc2626; 
        }
        .option.correct-answer { 
            background: #f0fdf4; 
            border-color: #16a34a; 
            color: #15803d; 
        }
        .option:disabled { 
            cursor: default; 
        }
        .explanation { 
            background: #eff6ff; 
            padding: 16px; 
            border-radius: 8px; 
            margin-bottom: 16px; 
        }
        .explanation-label { 
            font-size: 11px; 
            font-weight: 600; 
            color: #1e40af; 
            margin-bottom: 6px; 
        }
        .explanation-text { 
            font-size: 14px; 
            color: #1e40af; 
            line-height: 1.4; 
        }
        .actions { 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
        }
        .btn { 
            width: 100%; 
            padding: 14px; 
            border-radius: 8px; 
            border: none; 
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.2s; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 8px; 
            font-size: 15px;
        }
        .btn-primary { 
            background: #dc2626; 
            color: white; 
        }
        .btn-primary:hover { 
            background: #991b1b; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="app"></div>
    </div>

    <script>
        const defaultCases = [
            // Emergency Cardiology (5 cases)
            {
                id: 1,
                category: "Emergency Cardiology - STEMI",
                urgency: "high",
                presentation: "67M EMS arrival with crushing chest pain radiating to left arm and jaw. Started 45 min ago while watching TV. Diaphoretic, anxious, nauseous. PMH: HTN, DM, smoking 2ppd x30 years.",
                vitals: "BP: 160/95, HR: 102, RR: 22, O2: 96% RA, Temp: 98.6°F, Weight: 85kg",
                steps: [
                    { 
                        question: "EKG shows 4mm ST elevation V1-V4, reciprocal depression II/III/aVF. Door time 15min. ED priority?", 
                        options: ["Thrombolytics in ED", "Activate cath lab for primary PCI", "Medical management", "Emergent CABG consult"], 
                        correct: 1, 
                        explanation: "Emergency activation of cath lab for primary PCI. Door-to-balloon goal <90min for STEMI patients." 
                    },
                    { 
                        question: "Patient becomes hypotensive 80/40 with cool extremities. Immediate ED intervention?", 
                        options: ["IV fluid bolus", "Dopamine infusion", "Emergency bedside echo", "Intubation"], 
                        correct: 2, 
                        explanation: "Bedside echo to assess for mechanical complications (VSD, papillary muscle rupture, tamponade) in shock." 
                    }
                ]
            },
            {
                id: 2,
                category: "Emergency Cardiology - Acute Heart Failure",
                urgency: "high", 
                presentation: "58F EMS transport for acute SOB. Unable to lie flat, bilateral crackles to apices, cool extremities, altered mental status. Known ischemic cardiomyopathy.",
                vitals: "BP: 85/60, HR: 110, RR: 28, O2: 85% RA, Temp: 97.8°F, BNP: 3500",
                steps: [
                    { 
                        question: "Initial ED assessment priority for this presentation?", 
                        options: ["Chest X-ray", "Bedside echocardiogram", "Arterial blood gas", "CT angiogram"], 
                        correct: 1, 
                        explanation: "Bedside echo rapidly assesses cardiac function and guides immediate ED management decisions." 
                    },
                    { 
                        question: "Immediate ED management for cardiogenic shock with pulmonary edema?", 
                        options: ["High-dose lasix", "BiPAP + inotropes", "Intubation first", "IV fluid challenge"], 
                        correct: 1, 
                        explanation: "BiPAP for respiratory support plus inotropes (dobutamine) for cardiogenic shock in ED." 
                    }
                ]
            },
            {
                id: 3,
                category: "Emergency Cardiology - Atrial Fibrillation with RVR",
                urgency: "medium",
                presentation: "72M palpitations and SOB x4 hours. No chest pain. PMH: HTN, hyperlipidemia. Irregular pulse, appears uncomfortable but stable.",
                vitals: "BP: 140/90, HR: 165 irregular, RR: 20, O2: 94% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Patient stable with new A-fib and RVR. ED rate control priority?",
                        options: ["Cardioversion", "Beta-blockers or calcium channel blockers", "Digoxin", "Amiodarone"],
                        correct: 1,
                        explanation: "Stable A-fib with RVR: rate control with metoprolol or diltiazem first-line in ED."
                    },
                    {
                        question: "Before cardioversion attempt, duration unknown A-fib requires?",
                        options: ["No anticoagulation needed", "Heparin bolus only", "TEE to rule out clot or 3 weeks anticoagulation", "Aspirin only"],
                        correct: 2,
                        explanation: "A-fib >48hrs or unknown duration: TEE to exclude clot OR 3 weeks therapeutic anticoagulation before cardioversion."
                    }
                ]
            },
            {
                id: 4,
                category: "Emergency Cardiology - Aortic Dissection",
                urgency: "high",
                presentation: "58M sudden severe 'tearing' chest pain to back while lifting weights. Pain 10/10, maximal at onset. PMH: poorly controlled HTN.",
                vitals: "BP: 180/110 (R arm), 155/90 (L arm), HR: 95, RR: 20, O2: 97% RA",
                steps: [
                    {
                        question: "BP differential 25mmHg between arms suggests?",
                        options: ["Measurement error", "Type A dissection with arch involvement", "Type B dissection only", "Subclavian stenosis"],
                        correct: 1,
                        explanation: "BP differential >20mmHg suggests Type A dissection involving arch vessels. Surgical emergency."
                    },
                    {
                        question: "Most appropriate ED imaging for stable patient?",
                        options: ["Chest X-ray first", "CT angiogram chest/abdomen/pelvis", "Bedside echo", "MRI aorta"],
                        correct: 1,
                        explanation: "CTA is ED imaging of choice: fast, accurate, widely available for suspected dissection."
                    }
                ]
            },
            {
                id: 5,
                category: "Emergency Cardiology - Hypertensive Emergency",
                urgency: "high",
                presentation: "55M severe headache, vision changes, and nausea. PMH: HTN, stopped taking medications 1 week ago. Papilledema on fundoscopy.",
                vitals: "BP: 220/130, HR: 95, RR: 18, O2: 96% RA, Temp: 98.8°F",
                steps: [
                    {
                        question: "Hypertensive emergency vs urgency differentiated by?",
                        options: ["Specific BP threshold", "Presence of end-organ damage", "Duration of symptoms", "Age of patient"],
                        correct: 1,
                        explanation: "Hypertensive emergency: severe HTN WITH end-organ damage (brain, heart, kidney, eyes)."
                    },
                    {
                        question: "Initial BP reduction goal in hypertensive emergency?",
                        options: ["Normalize BP immediately", "Reduce by 10-20% in first hour", "Reduce by 50%", "No reduction needed"],
                        correct: 1,
                        explanation: "Reduce BP by 10-20% in first hour, then gradual reduction to avoid cerebral hypoperfusion."
                    }
                ]
            },
            // Emergency Pulmonology (5 cases) 
            {
                id: 6,
                category: "Emergency Pulmonology - Massive PE",
                urgency: "high",
                presentation: "52M EMS Code Blue at airport customs after 14-hour flight. Witnessed collapse, CPR started. ROSC achieved. PMH: Factor V Leiden, recent knee surgery 3 weeks ago.",
                vitals: "BP: 75/45, HR: 135, RR: 32, O2: 78% on 15L NRB, Temp: 98.2°F",
                steps: [
                    { 
                        question: "Hemodynamically unstable suspected massive PE. ED priority assessment?", 
                        options: ["STAT CT angiogram", "Bedside echocardiogram", "D-dimer level", "Arterial blood gas"], 
                        correct: 1, 
                        explanation: "Bedside echo immediately assesses RV strain in unstable patient. Don't delay care for CT in shock." 
                    },
                    { 
                        question: "Echo shows severe RV strain. Recent surgery 3 weeks ago. ED thrombolysis decision?", 
                        options: ["Absolute contraindication", "Benefits outweigh risks - give tPA", "Wait for surgery consult", "Give half-dose tPA"], 
                        correct: 1, 
                        explanation: "Massive PE with cardiac arrest may justify thrombolysis despite recent surgery in ED setting." 
                    }
                ]
            },
            {
                id: 7,
                category: "Emergency Pulmonology - Tension Pneumothorax",
                urgency: "high",
                presentation: "28M trauma activation after motorcycle collision. Severe respiratory distress, tracheal deviation to left, absent breath sounds on right, JVD, hypotensive.",
                vitals: "BP: 70/40, HR: 140, RR: 35, O2: 78% on BVM, Temp: 98.2°F",
                steps: [
                    { 
                        question: "Clinical presentation suggests tension pneumothorax. Immediate ED intervention?", 
                        options: ["STAT chest X-ray", "14G needle 2nd ICS midclavicular", "Emergency chest tube", "Intubate first"], 
                        correct: 1, 
                        explanation: "Tension pneumothorax is clinical diagnosis. Immediate needle decompression saves life in ED." 
                    },
                    { 
                        question: "After needle decompression, patient stabilizes. Next ED step?", 
                        options: ["Repeat needle decompression", "Chest tube 5th ICS anterior axillary", "Observe and monitor", "Discharge home"], 
                        correct: 1, 
                        explanation: "After needle decompression, definitive chest tube placement is required in ED." 
                    }
                ]
            },
            {
                id: 8,
                category: "Emergency Pulmonology - Acute Asthma Exacerbation",
                urgency: "high",
                presentation: "25F severe SOB and wheezing x2 hours. Using accessory muscles, speaking in words only. PMH: asthma, recent URI. Peak flow 40% predicted.",
                vitals: "BP: 125/80, HR: 125, RR: 32, O2: 88% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Signs of severe asthma exacerbation in ED include?",
                        options: ["Normal speech", "Peak flow >70% predicted", "Speaking in words only + accessory muscles", "Normal vital signs"],
                        correct: 2,
                        explanation: "Severe asthma: speaking in words only, accessory muscles, peak flow <50%, HR >120, RR >30."
                    },
                    {
                        question: "First-line ED treatment for severe asthma exacerbation?",
                        options: ["Nebulized albuterol + ipratropium + oral steroids", "Intubation", "Antibiotics", "Chest X-ray first"],
                        correct: 0,
                        explanation: "Severe asthma: continuous nebulized albuterol + ipratropium + systemic corticosteroids immediately."
                    }
                ]
            },
            {
                id: 9,
                category: "Emergency Pulmonology - Spontaneous Pneumothorax",
                urgency: "medium",
                presentation: "22M tall, thin college student with sudden onset sharp chest pain and SOB while studying. No trauma. Pain sharp, worse with inspiration.",
                vitals: "BP: 120/80, HR: 95, RR: 22, O2: 92% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Most common demographic for primary spontaneous pneumothorax?",
                        options: ["Elderly obese females", "Young tall thin males", "Middle-aged athletes", "Children"],
                        correct: 1,
                        explanation: "Primary spontaneous pneumothorax: young (20-30s), tall, thin males, often smokers."
                    },
                    {
                        question: "Treatment for first-time spontaneous pneumothorax >20%?",
                        options: ["Observation only", "Needle decompression", "Chest tube placement", "Surgery"],
                        correct: 2,
                        explanation: "Pneumothorax >20% or symptomatic: chest tube placement. <20% and stable: may observe."
                    }
                ]
            },
            {
                id: 10,
                category: "Emergency Pulmonology - COPD Exacerbation",
                urgency: "medium",
                presentation: "68M increased SOB, cough, and sputum production x3 days. PMH: COPD, 40 pack-year smoking history. Using accessory muscles, pursed lip breathing.",
                vitals: "BP: 135/85, HR: 105, RR: 28, O2: 85% RA, Temp: 99.2°F",
                steps: [
                    {
                        question: "ABG shows pH 7.25, CO2 65, HCO3 28. This represents?",
                        options: ["Respiratory alkalosis", "Acute respiratory acidosis", "Chronic compensated respiratory acidosis", "Metabolic acidosis"],
                        correct: 1,
                        explanation: "pH <7.35 with elevated CO2 = respiratory acidosis. HCO3 elevated but inadequate compensation."
                    },
                    {
                        question: "ED treatment for COPD exacerbation includes?",
                        options: ["High-flow oxygen", "Bronchodilators + steroids + controlled O2", "Antibiotics only", "Intubation first"],
                        correct: 1,
                        explanation: "COPD exacerbation: bronchodilators, systemic steroids, controlled oxygen (88-92% target)."
                    }
                ]
            },
            // Emergency Neurology (5 cases)
            {
                id: 11,
                category: "Emergency Neurology - Acute Stroke",
                urgency: "high",
                presentation: "72F EMS activation for sudden onset left-sided weakness and speech difficulty. Symptoms started 2 hours ago. PMH: A-fib, not on anticoagulation.",
                vitals: "BP: 185/105, HR: 88 irregular, RR: 16, O2: 98% RA, Glucose: 145",
                steps: [
                    {
                        question: "Patient meets criteria for potential thrombolysis. Most critical ED timeline?",
                        options: ["CT within 25 minutes", "Thrombolytics within 4.5 hours", "Both CT <25min and tPA <4.5hrs", "Neurology consult first"],
                        correct: 2,
                        explanation: "Stroke protocol: CT within 25 minutes of arrival AND thrombolytics within 4.5 hours of symptom onset."
                    },
                    {
                        question: "CT shows no hemorrhage, NIHSS=12. BP 185/105. ED management before tPA?",
                        options: ["No BP treatment needed", "Lower BP to <140/90", "Lower BP to <185/110", "Lower BP to <160/100"],
                        correct: 2,
                        explanation: "For tPA eligibility: BP must be <185/110. Use labetalol or nicardipine to achieve target."
                    }
                ]
            },
            {
                id: 12,
                category: "Emergency Neurology - Status Epilepticus",
                urgency: "high",
                presentation: "34M brought by EMS with continuous seizure activity >10 minutes. Bystanders report seizure started at home. PMH: epilepsy, poor medication compliance.",
                vitals: "BP: 150/90, HR: 120, RR: 16 assisted, O2: 92% BVM, Temp: 101.2°F",
                steps: [
                    {
                        question: "First-line ED treatment for status epilepticus?",
                        options: ["IV phenytoin", "IV lorazepam or diazepam", "IV propofol", "Intubation first"],
                        correct: 1,
                        explanation: "Status epilepticus: IV benzodiazepines (lorazepam 4mg or diazepam 10mg) are first-line."
                    },
                    {
                        question: "Benzodiazepines fail to stop seizure. Next ED intervention?",
                        options: ["Repeat benzodiazepines", "IV phenytoin or fosphenytoin", "IV propofol", "Neurosurgery consult"],
                        correct: 1,
                        explanation: "Refractory status epilepticus: IV phenytoin 20mg/kg or fosphenytoin equivalent after benzos fail."
                    }
                ]
            },
            {
                id: 13,
                category: "Emergency Neurology - Subarachnoid Hemorrhage",
                urgency: "high",
                presentation: "45F sudden onset worst headache of life while exercising. Vomiting, photophobia, neck stiffness. 'Thunderclap' headache, never had anything like this.",
                vitals: "BP: 170/100, HR: 95, RR: 18, O2: 98% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Clinical presentation most concerning for?",
                        options: ["Migraine", "Tension headache", "Subarachnoid hemorrhage", "Meningitis"],
                        correct: 2,
                        explanation: "Thunderclap headache = worst headache of life with sudden onset suggests SAH until proven otherwise."
                    },
                    {
                        question: "Non-contrast head CT normal. Next ED step for SAH workup?",
                        options: ["Discharge with headache precautions", "Lumbar puncture", "CT angiogram head/neck", "MRI brain"],
                        correct: 1,
                        explanation: "SAH suspected with normal CT: LP to look for xanthochromia and RBCs that don't clear."
                    }
                ]
            },
            {
                id: 14,
                category: "Emergency Neurology - Acute Vertigo",
                urgency: "medium",
                presentation: "67M acute onset severe dizziness with nausea and vomiting. Room spinning sensation, difficulty walking. PMH: HTN, DM, smoking. Horizontal nystagmus present.",
                vitals: "BP: 160/95, HR: 88, RR: 16, O2: 96% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Key examination to differentiate peripheral vs central vertigo?",
                        options: ["Romberg test", "HINTS exam (Head Impulse, Nystagmus, Test of Skew)", "Weber test", "Dix-Hallpike maneuver"],
                        correct: 1,
                        explanation: "HINTS exam more sensitive than MRI for acute stroke in vertigo patients with risk factors."
                    },
                    {
                        question: "HINTS exam suggests central cause. Most appropriate ED imaging?",
                        options: ["No imaging needed", "CT head", "MRI brain with DWI", "CT angiogram"],
                        correct: 2,
                        explanation: "Central vertigo suggested by HINTS: MRI with DWI to evaluate for posterior circulation stroke."
                    }
                ]
            },
            {
                id: 15,
                category: "Emergency Neurology - Bacterial Meningitis",
                urgency: "high",
                presentation: "23M college student with fever, severe headache, neck stiffness x12 hours. Petechial rash on trunk and extremities. Altered mental status.",
                vitals: "BP: 90/60, HR: 125, RR: 24, O2: 94% RA, Temp: 102.8°F",
                steps: [
                    {
                        question: "Clinical presentation with petechial rash most suggests?",
                        options: ["Viral meningitis", "Pneumococcal meningitis", "Meningococcal meningitis", "Herpes encephalitis"],
                        correct: 2,
                        explanation: "Petechial/purpuric rash with meningitis suggests meningococcal disease - medical emergency."
                    },
                    {
                        question: "Suspected bacterial meningitis with shock. ED priority before LP?",
                        options: ["Blood cultures then antibiotics", "CT head first", "Lumbar puncture immediately", "Fluid resuscitation"],
                        correct: 0,
                        explanation: "Suspected bacterial meningitis: blood cultures then empiric antibiotics. Don't delay for LP if unstable."
                    }
                ]
            },
            // Emergency Gastroenterology (5 cases)
            {
                id: 16,
                category: "Emergency Gastroenterology - Upper GI Bleed",
                urgency: "high",
                presentation: "58M hematemesis and melena x6 hours. Lightheaded when standing. PMH: cirrhosis, previous variceal bleeding, takes NSAIDs for arthritis.",
                vitals: "BP: 100/60 (lying), 85/50 (standing), HR: 110, RR: 20, O2: 96% RA",
                steps: [
                    {
                        question: "Initial ED management priority for upper GI bleeding?",
                        options: ["Immediate endoscopy", "IV access and fluid resuscitation", "PPI infusion", "Type and crossmatch"],
                        correct: 1,
                        explanation: "Upper GI bleed with orthostatic changes: immediate large-bore IV access and volume resuscitation."
                    },
                    {
                        question: "Patient with cirrhosis and GI bleeding. Additional ED management?",
                        options: ["Prophylactic antibiotics", "Octreotide infusion", "Both antibiotics and octreotide", "Neither needed"],
                        correct: 2,
                        explanation: "Cirrhosis + GI bleed: prophylactic antibiotics AND octreotide to reduce portal pressure."
                    }
                ]
            },
            {
                id: 17,
                category: "Emergency Gastroenterology - Acute Pancreatitis",
                urgency: "high",
                presentation: "42F severe epigastric pain radiating to back, nausea, vomiting x8 hours. Pain constant, 9/10. PMH: gallstones, social alcohol use.",
                vitals: "BP: 110/70, HR: 105, RR: 22, O2: 95% RA, Temp: 100.4°F",
                steps: [
                    {
                        question: "Lab results: Lipase 890 (nl <60), WBC 15k. Most likely etiology?",
                        options: ["Alcohol-induced", "Gallstone pancreatitis", "Idiopathic", "Drug-induced"],
                        correct: 1,
                        explanation: "Female with known gallstones: gallstone pancreatitis most likely cause."
                    },
                    {
                        question: "Initial ED management for acute pancreatitis?",
                        options: ["NPO and pain control only", "Aggressive IV fluids + pain control", "Immediate surgery consult", "Antibiotics"],
                        correct: 1,
                        explanation: "Acute pancreatitis: aggressive IV fluid resuscitation (LR preferred) and adequate pain control."
                    }
                ]
            },
            {
                id: 18,
                category: "Emergency Gastroenterology - Bowel Obstruction",
                urgency: "medium",
                presentation: "65M crampy abdominal pain, vomiting, no flatus x24 hours. Previous appendectomy 20 years ago. Abdomen distended, high-pitched bowel sounds.",
                vitals: "BP: 120/80, HR: 95, RR: 18, O2: 96% RA, Temp: 98.8°F",
                steps: [
                    {
                        question: "Most likely cause of small bowel obstruction in this patient?",
                        options: ["Hernia", "Adhesions from prior surgery", "Tumor", "Intussusception"],
                        correct: 1,
                        explanation: "Most common cause of SBO in adults: adhesions from previous abdominal surgery."
                    },
                    {
                        question: "CT shows small bowel obstruction without strangulation. Initial ED management?",
                        options: ["Immediate surgery", "NGT decompression + IV fluids", "Oral contrast challenge", "Discharge with follow-up"],
                        correct: 1,
                        explanation: "Uncomplicated SBO: NGT decompression, IV fluids, NPO. Many resolve without surgery."
                    }
                ]
            },
            {
                id: 19,
                category: "Emergency Gastroenterology - Acute Cholangitis",
                urgency: "high",
                presentation: "70M jaundice, fever, and RUQ pain x2 days. Charcot's triad present. PMH: cholelithiasis. Appears septic with altered mental status.",
                vitals: "BP: 85/50, HR: 120, RR: 24, O2: 94% RA, Temp: 103.2°F",
                steps: [
                    {
                        question: "Charcot's triad consists of?",
                        options: ["Fever, jaundice, RUQ pain", "Fever, hypotension, confusion", "Jaundice, pain, confusion", "All of the above"],
                        correct: 0,
                        explanation: "Charcot's triad: fever, jaundice, RUQ pain. Reynolds pentad adds hypotension and confusion."
                    },
                    {
                        question: "Patient meets criteria for acute cholangitis with sepsis. ED priorities?",
                        options: ["IV antibiotics only", "Emergent ERCP", "Antibiotics + fluid resuscitation + urgent ERCP", "Surgery consult"],
                        correct: 2,
                        explanation: "Acute cholangitis: broad-spectrum antibiotics, resuscitation, urgent biliary decompression (ERCP)."
                    }
                ]
            },
            {
                id: 20,
                category: "Emergency Gastroenterology - Acute Appendicitis",
                urgency: "medium",
                presentation: "28M periumbilical pain migrating to RLQ x12 hours. Anorexia, nausea, low-grade fever. RLQ tenderness, positive Rovsing's sign.",
                vitals: "BP: 125/75, HR: 88, RR: 16, O2: 98% RA, Temp: 100.8°F",
                steps: [
                    {
                        question: "Most reliable clinical finding for appendicitis?",
                        options: ["Fever", "Elevated WBC", "RLQ tenderness", "Migration of pain"],
                        correct: 2,
                        explanation: "RLQ tenderness most reliable clinical finding. Classic migration occurs in <50% of patients."
                    },
                    {
                        question: "CT shows acute appendicitis without perforation. ED management?",
                        options: ["Antibiotics and discharge", "Immediate appendectomy", "Surgery consult + antibiotics + NPO", "Observation only"],
                        correct: 2,
                        explanation: "Acute appendicitis: surgery consult, IV antibiotics, NPO, pain control while awaiting OR."
                    }
                ]
            },
            // Emergency Nephrology (5 cases)
            {
                id: 21,
                category: "Emergency Nephrology - Acute Kidney Injury",
                urgency: "medium",
                presentation: "68F decreased urine output x3 days. PMH: CHF, DM, HTN, recent contrast CT 5 days ago. Taking lisinopril, metformin, lasix.",
                vitals: "BP: 160/95, HR: 88, RR: 20, O2: 94% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Creatinine 3.2 (baseline 1.1), BUN 65. Most likely cause of AKI?",
                        options: ["Prerenal azotemia", "Contrast-induced nephropathy", "ACE inhibitor toxicity", "Diabetic nephropathy"],
                        correct: 1,
                        explanation: "Recent contrast exposure with AKI onset 3-5 days later suggests contrast-induced nephropathy."
                    },
                    {
                        question: "Patient taking metformin with AKI. ED management concern?",
                        options: ["Continue metformin", "Hold metformin - lactic acidosis risk", "Increase metformin dose", "Switch to insulin only"],
                        correct: 1,
                        explanation: "Hold metformin in AKI due to increased risk of lactic acidosis with decreased clearance."
                    }
                ]
            },
            {
                id: 22,
                category: "Emergency Nephrology - Hyperkalemia",
                urgency: "high",
                presentation: "55M EMS transport for weakness and palpitations. PMH: CKD, missed dialysis x3 days. EKG shows peaked T waves and wide QRS.",
                vitals: "BP: 150/90, HR: 45, RR: 18, O2: 96% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "EKG changes with hyperkalemia. Most concerning finding?",
                        options: ["Peaked T waves", "Wide QRS complexes", "Sine wave pattern", "All are concerning"],
                        correct: 3,
                        explanation: "All EKG changes in hyperkalemia are concerning. Progression: peaked T → wide QRS → sine wave."
                    },
                    {
                        question: "Severe hyperkalemia with EKG changes. Immediate ED treatment?",
                        options: ["Kayexalate only", "Calcium gluconate + insulin/glucose", "Dialysis first", "Albuterol nebulizer"],
                        correct: 1,
                        explanation: "Severe hyperkalemia with EKG changes: calcium for cardiac protection, then insulin/glucose to shift K+."
                    }
                ]
            },
            {
                id: 23,
                category: "Emergency Nephrology - Nephrolithiasis",
                urgency: "medium",
                presentation: "35M sudden onset severe left flank pain radiating to groin. Pain colicky, 10/10, nausea, vomiting. Restless, unable to find comfortable position.",
                vitals: "BP: 140/90, HR: 105, RR: 20, O2: 96% RA, Temp: 98.6°F, UA: microscopic hematuria",
                steps: [
                    {
                        question: "Clinical presentation most consistent with?",
                        options: ["Pyelonephritis", "Renal cell carcinoma", "Nephrolithiasis", "Aortic aneurysm"],
                        correct: 2,
                        explanation: "Sudden severe colicky flank pain to groin with hematuria = kidney stone until proven otherwise."
                    },
                    {
                        question: "CT shows 6mm stone at ureterovesical junction. ED management?",
                        options: ["Immediate urology consult", "Pain control + medical expulsive therapy", "Lithotripsy", "Observation only"],
                        correct: 1,
                        explanation: "Stone 5-10mm: pain control + alpha-blocker (tamsulosin) for medical expulsive therapy."
                    }
                ]
            },
            {
                id: 24,
                category: "Emergency Nephrology - Acute Glomerulonephritis",
                urgency: "medium",
                presentation: "45M dark urine, facial swelling, and HTN x1 week. Recent strep throat 2 weeks ago. Periorbital edema, HTN, proteinuria.",
                vitals: "BP: 180/110, HR: 88, RR: 18, O2: 96% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Clinical presentation suggests?",
                        options: ["Acute tubular necrosis", "Post-infectious glomerulonephritis", "Nephrotic syndrome", "Chronic kidney disease"],
                        correct: 1,
                        explanation: "Post-streptococcal glomerulonephritis: dark urine, edema, HTN 1-3 weeks after strep infection."
                    },
                    {
                        question: "Patient has severe hypertension with glomerulonephritis. ED management?",
                        options: ["No treatment needed", "Gradual BP reduction", "Immediate BP normalization", "Dialysis"],
                        correct: 1,
                        explanation: "Hypertension in glomerulonephritis: gradual reduction to avoid compromising renal perfusion."
                    }
                ]
            },
            {
                id: 25,
                category: "Emergency Nephrology - Urinary Retention",
                urgency: "medium",
                presentation: "72M inability to urinate x8 hours with severe suprapubic pain. PMH: BPH, taking alpha-blockers. Bladder palpable to umbilicus.",
                vitals: "BP: 150/85, HR: 95, RR: 18, O2: 96% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Most likely cause of acute urinary retention in elderly male?",
                        options: ["UTI", "Benign prostatic hyperplasia", "Prostate cancer", "Neurogenic bladder"],
                        correct: 1,
                        explanation: "Acute urinary retention in elderly males: most commonly BPH, especially with precipitating factors."
                    },
                    {
                        question: "Immediate ED management for acute urinary retention?",
                        options: ["Alpha-blocker trial", "Foley catheter insertion", "Suprapubic catheter", "Urology consult first"],
                        correct: 1,
                        explanation: "Acute urinary retention: immediate relief with Foley catheter insertion in ED."
                    }
                ]
            },
            // Emergency Endocrinology (5 cases)
            {
                id: 26,
                category: "Emergency Endocrinology - DKA",
                urgency: "high",
                presentation: "22F type 1 diabetic with nausea, vomiting, abdominal pain x2 days. Kussmaul respirations, fruity breath odor, dehydrated. Ran out of insulin 3 days ago.",
                vitals: "BP: 100/60, HR: 120, RR: 28, O2: 98% RA, Temp: 98.6°F, Glucose: 485",
                steps: [
                    {
                        question: "ABG shows pH 7.15, CO2 15, HCO3 8. Ketones positive. This represents?",
                        options: ["Respiratory acidosis", "Metabolic alkalosis", "Diabetic ketoacidosis", "Hyperosmolar state"],
                        correct: 2,
                        explanation: "DKA triad: hyperglycemia + ketosis + metabolic acidosis. Kussmaul respirations compensate."
                    },
                    {
                        question: "Initial ED fluid management for DKA?",
                        options: ["D5W", "Normal saline", "Half normal saline", "Lactated Ringer's"],
                        correct: 1,
                        explanation: "DKA initial fluid: normal saline for volume resuscitation, then switch based on sodium levels."
                    }
                ]
            },
            {
                id: 27,
                category: "Emergency Endocrinology - Hyperosmolar Hyperglycemic State",
                urgency: "high",
                presentation: "68M type 2 diabetic found confused at home. Severe dehydration, altered mental status. No ketones detected. Recent pneumonia on antibiotics.",
                vitals: "BP: 90/50, HR: 110, RR: 20, O2: 94% RA, Temp: 101.2°F, Glucose: 850",
                steps: [
                    {
                        question: "Glucose 850, no ketones, altered mental status. Most likely diagnosis?",
                        options: ["DKA", "Hyperosmolar hyperglycemic state", "Sepsis", "Stroke"],
                        correct: 1,
                        explanation: "HHS: severe hyperglycemia + dehydration + altered mental status WITHOUT significant ketosis."
                    },
                    {
                        question: "HHS management differs from DKA how?",
                        options: ["Higher insulin doses", "More aggressive fluid resuscitation", "No insulin needed", "Same management"],
                        correct: 1,
                        explanation: "HHS requires more aggressive fluid resuscitation due to severe volume depletion vs DKA."
                    }
                ]
            },
            {
                id: 28,
                category: "Emergency Endocrinology - Severe Hypoglycemia",
                urgency: "high",
                presentation: "45M type 1 diabetic found unconscious by family. Diaphoretic, tachycardic. Family reports he took insulin but didn't eat. Glucometer reads 'LOW'.",
                vitals: "BP: 120/80, HR: 110, RR: 16, O2: 98% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Unconscious patient with suspected severe hypoglycemia. Immediate ED treatment?",
                        options: ["Oral glucose", "IV D50W", "Glucagon IM", "Both IV D50W and glucagon"],
                        correct: 1,
                        explanation: "Unconscious hypoglycemic patient: IV D50W (25g dextrose) for immediate reversal."
                    },
                    {
                        question: "Patient awakens after D50W. Next ED management?",
                        options: ["Discharge immediately", "Observe + repeat glucose checks + meal", "Insulin infusion", "ICU admission"],
                        correct: 1,
                        explanation: "Post-hypoglycemic: observe for recurrence, serial glucose checks, ensure patient eats."
                    }
                ]
            },
            {
                id: 29,
                category: "Emergency Endocrinology - Thyroid Storm",
                urgency: "high",
                presentation: "35F hyperthyroid patient with fever, tachycardia, altered mental status. Recent medication non-compliance. Agitated, diaphoretic, tremulous.",
                vitals: "BP: 160/90, HR: 160, RR: 24, O2: 96% RA, Temp: 104.2°F",
                steps: [
                    {
                        question: "Clinical presentation concerning for?",
                        options: ["Hyperthyroidism", "Thyroid storm", "Sepsis", "Drug withdrawal"],
                        correct: 1,
                        explanation: "Thyroid storm: hyperthyroid symptoms + fever + altered mental status. Medical emergency."
                    },
                    {
                        question: "First-line ED treatment for thyroid storm?",
                        options: ["Propylthiouracil only", "Beta-blockers only", "PTU + beta-blockers + iodine + steroids", "Thyroidectomy"],
                        correct: 2,
                        explanation: "Thyroid storm: PTU (blocks synthesis) + propranolol + iodine (blocks release) + steroids."
                    }
                ]
            },
            {
                id: 30,
                category: "Emergency Endocrinology - Adrenal Crisis",
                urgency: "high",
                presentation: "52F known Addison's disease with nausea, vomiting, weakness x2 days. Stopped taking prednisone due to side effects. Hypotensive, confused.",
                vitals: "BP: 75/45, HR: 125, RR: 22, O2: 96% RA, Temp: 99.8°F, Na: 125, K: 5.8",
                steps: [
                    {
                        question: "Patient with Addison's disease in shock. Most likely diagnosis?",
                        options: ["Sepsis", "Adrenal crisis", "Dehydration", "Medication overdose"],
                        correct: 1,
                        explanation: "Known adrenal insufficiency + steroid withdrawal + shock = adrenal crisis."
                    },
                    {
                        question: "Immediate ED treatment for adrenal crisis?",
                        options: ["Oral prednisone", "IV hydrocortisone + fluid resuscitation", "Fludrocortisone only", "IV insulin"],
                        correct: 1,
                        explanation: "Adrenal crisis: immediate IV hydrocortisone (100-200mg) + aggressive fluid resuscitation."
                    }
                ]
            },
            // Additional specialties continue with the same pattern...
            // Emergency Trauma (5 cases)
            {
                id: 31,
                category: "Emergency Trauma - Traumatic Brain Injury",
                urgency: "high",
                presentation: "28M motorcycle collision, unconscious at scene x5 minutes. GCS 10 on arrival. Right pupil dilated and sluggish. Left hemiparesis noted.",
                vitals: "BP: 180/110, HR: 55, RR: 10 irregular, O2: 96% intubated, Temp: 98.6°F",
                steps: [
                    {
                        question: "Clinical findings suggest which complication?",
                        options: ["Diffuse axonal injury", "Epidural hematoma", "Subdural hematoma", "Increased intracranial pressure"],
                        correct: 3,
                        explanation: "Cushing's triad (HTN, bradycardia, irregular breathing) + blown pupil = increased ICP."
                    },
                    {
                        question: "Immediate ED management for increased ICP?",
                        options: ["Hyperventilation only", "Mannitol or hypertonic saline", "Both hyperventilation and osmotic agents", "Steroids"],
                        correct: 2,
                        explanation: "Increased ICP: hyperventilation to PCO2 30-35 + mannitol/hypertonic saline + head elevation."
                    }
                ]
            },
            {
                id: 32,
                category: "Emergency Trauma - Hemorrhagic Shock",
                urgency: "high",
                presentation: "42M construction worker fell 20 feet onto rebar. Penetrating abdominal injury with active bleeding. Pale, diaphoretic, altered mental status.",
                vitals: "BP: 70/40, HR: 140, RR: 28, O2: 92% 15L NRB, Temp: 97.2°F",
                steps: [
                    {
                        question: "Patient in Class III-IV hemorrhagic shock. ED priority?",
                        options: ["FAST exam first", "Two large-bore IVs + type O blood", "CT scan", "Surgery consult"],
                        correct: 1,
                        explanation: "Class III-IV shock: immediate vascular access + blood products. Don't delay for imaging."
                    },
                    {
                        question: "Massive transfusion protocol. Initial blood product ratio?",
                        options: ["PRBC only", "1:1:1 PRBC:FFP:platelets", "2:1:1 PRBC:FFP:platelets", "PRBC + crystalloids"],
                        correct: 1,
                        explanation: "Massive transfusion: balanced 1:1:1 ratio of PRBC:FFP:platelets to prevent coagulopathy."
                    }
                ]
            },
            {
                id: 33,
                category: "Emergency Trauma - Spinal Cord Injury",
                urgency: "high",
                presentation: "19M diving accident in shallow water. C-spine immobilized by EMS. No movement below nipple line, loss of sensation, neurogenic shock.",
                vitals: "BP: 85/50, HR: 55, RR: 16, O2: 94% RA, Temp: 96.8°F",
                steps: [
                    {
                        question: "Clinical presentation suggests injury at which level?",
                        options: ["C1-C4", "C5-C6", "T4-T6", "T10-T12"],
                        correct: 2,
                        explanation: "Loss of sensation/movement below nipple line = T4 level spinal cord injury."
                    },
                    {
                        question: "Neurogenic shock management in ED?",
                        options: ["IV fluids only", "Vasopressors only", "Careful fluid resuscitation + vasopressors", "No treatment needed"],
                        correct: 2,
                        explanation: "Neurogenic shock: judicious fluids (avoid overload) + vasopressors (phenylephrine preferred)."
                    }
                ]
            },
            {
                id: 34,
                category: "Emergency Trauma - Flail Chest",
                urgency: "high",
                presentation: "55M high-speed MVC with multiple rib fractures. Paradoxical chest wall movement, severe respiratory distress. Bilateral chest tubes placed.",
                vitals: "BP: 110/70, HR: 110, RR: 32, O2: 85% 15L NRB, Temp: 98.6°F",
                steps: [
                    {
                        question: "Flail chest is defined as?",
                        options: ["Single rib fracture", "Two adjacent rib fractures", "Three or more consecutive ribs fractured in two places", "Sternal fracture"],
                        correct: 2,
                        explanation: "Flail chest: ≥3 consecutive ribs fractured in ≥2 places, creating unstable chest wall segment."
                    },
                    {
                        question: "Patient with flail chest and respiratory failure. ED management?",
                        options: ["Pain control only", "Mechanical ventilation with PEEP", "Surgical fixation", "Observation"],
                        correct: 1,
                        explanation: "Flail chest with respiratory failure: mechanical ventilation provides internal pneumatic splinting."
                    }
                ]
            },
            {
                id: 35,
                category: "Emergency Trauma - Pelvic Fracture",
                urgency: "high",
                presentation: "48F pedestrian struck by car. Pelvic instability on exam, hematuria. Hypotensive with ongoing blood loss. FAST exam positive.",
                vitals: "BP: 80/50, HR: 125, RR: 24, O2: 94% RA, Temp: 97.8°F",
                steps: [
                    {
                        question: "Unstable pelvic fracture with hemodynamic instability. ED priority?",
                        options: ["CT pelvis first", "Pelvic binder + resuscitation", "Surgery consult", "Angiography"],
                        correct: 1,
                        explanation: "Unstable pelvic fracture + shock: immediate pelvic binder + aggressive resuscitation."
                    },
                    {
                        question: "Continued bleeding despite pelvic binder. Next step?",
                        options: ["More IV fluids", "Emergency surgery", "Angiography with embolization", "REBOA"],
                        correct: 2,
                        explanation: "Ongoing pelvic bleeding: angiography with selective embolization often controls hemorrhage."
                    }
                ]
            },
            // Emergency Infectious Disease (5 cases)
            {
                id: 36,
                category: "Emergency Infectious Disease - Septic Shock",
                urgency: "high",
                presentation: "72M nursing home resident with altered mental status, fever, hypotension. Foley catheter in place x1 month. Cloudy, malodorous urine.",
                vitals: "BP: 75/45, HR: 115, RR: 26, O2: 91% RA, Temp: 102.8°F, Lactate: 4.2",
                steps: [
                    {
                        question: "Patient meets criteria for septic shock. Initial ED intervention?",
                        options: ["Antibiotics first", "Fluid bolus first", "Blood cultures then antibiotics + fluids", "Vasopressors"],
                        correct: 2,
                        explanation: "Septic shock: obtain cultures quickly, then antibiotics within 1 hour + 30ml/kg fluid bolus."
                    },
                    {
                        question: "After 30ml/kg fluids, BP remains 80/50. Next ED step?",
                        options: ["More fluids", "Start norepinephrine", "Dobutamine", "Continue observation"],
                        correct: 1,
                        explanation: "Refractory hypotension after adequate fluids: start norepinephrine (first-line vasopressor)."
                    }
                ]
            },
            {
                id: 37,
                category: "Emergency Infectious Disease - Cellulitis vs Necrotizing Fasciitis",
                urgency: "high",
                presentation: "45M diabetic with rapidly spreading leg infection. Started as small cut 2 days ago. Now severe pain, dusky skin, crepitus, systemic toxicity.",
                vitals: "BP: 100/60, HR: 120, RR: 22, O2: 94% RA, Temp: 103.4°F, WBC: 18k",
                steps: [
                    {
                        question: "Clinical findings most concerning for necrotizing fasciitis?",
                        options: ["Erythema and warmth", "Pain out of proportion + crepitus", "Fever and leukocytosis", "Purulent drainage"],
                        correct: 1,
                        explanation: "Necrotizing fasciitis: pain out of proportion to appearance + crepitus + systemic toxicity."
                    },
                    {
                        question: "Suspected necrotizing fasciitis. Most important ED intervention?",
                        options: ["IV antibiotics", "Immediate surgical debridement", "CT scan first", "Hyperbaric oxygen"],
                        correct: 1,
                        explanation: "Necrotizing fasciitis: emergent surgical debridement is definitive treatment. Time is tissue."
                    }
                ]
            },
            {
                id: 38,
                category: "Emergency Infectious Disease - Endocarditis",
                urgency: "medium",
                presentation: "32M IV drug user with fever, fatigue, new heart murmur x1 week. Janeway lesions on palms, splinter hemorrhages under nails.",
                vitals: "BP: 120/60, HR: 95, RR: 18, O2: 96% RA, Temp: 101.8°F",
                steps: [
                    {
                        question: "Clinical findings suggest which diagnosis?",
                        options: ["Rheumatic fever", "Acute endocarditis", "Pericarditis", "Myocarditis"],
                        correct: 1,
                        explanation: "IV drug use + fever + new murmur + peripheral stigmata = acute endocarditis."
                    },
                    {
                        question: "ED workup for suspected endocarditis should include?",
                        options: ["Blood cultures x2", "Blood cultures x3 + echocardiogram", "Echocardiogram only", "Cardiac catheterization"],
                        correct: 1,
                        explanation: "Endocarditis workup: 3 sets blood cultures + echocardiogram to assess valve function."
                    }
                ]
            },
            {
                id: 39,
                category: "Emergency Infectious Disease - Pneumonia with Sepsis",
                urgency: "high",
                presentation: "68F cough, fever, SOB x3 days. Nursing home resident. Productive cough with purulent sputum. Bilateral lower lobe crackles.",
                vitals: "BP: 95/55, HR: 105, RR: 28, O2: 88% RA, Temp: 102.2°F, WBC: 16k",
                steps: [
                    {
                        question: "CURB-65 score helps determine?",
                        options: ["Antibiotic choice", "Need for ICU admission", "Severity and disposition", "Prognosis only"],
                        correct: 2,
                        explanation: "CURB-65 (Confusion, Urea, RR, BP, age ≥65): predicts severity and guides disposition."
                    },
                    {
                        question: "Nursing home resident with severe pneumonia. Empiric ED antibiotics?",
                        options: ["Azithromycin only", "Ceftriaxone + azithromycin", "Vancomycin + piperacillin-tazobactam", "Levofloxacin"],
                        correct: 2,
                        explanation: "Nursing home pneumonia: broad coverage including MRSA and Pseudomonas (vancomycin + pip-tazo)."
                    }
                ]
            },
            {
                id: 40,
                category: "Emergency Infectious Disease - Influenza with Complications",
                urgency: "medium",
                presentation: "25F pregnant (32 weeks) with fever, cough, SOB x4 days. Flu-like symptoms progressing to respiratory distress. Recent flu exposure.",
                vitals: "BP: 110/70, HR: 110, RR: 26, O2: 90% RA, Temp: 102.4°F",
                steps: [
                    {
                        question: "Pregnant patient with influenza and respiratory symptoms. ED treatment priority?",
                        options: ["Supportive care only", "Oseltamivir + supportive care", "Antibiotics for secondary infection", "Immediate delivery"],
                        correct: 1,
                        explanation: "Pregnant women with influenza: oseltamivir indicated regardless of symptom duration due to high risk."
                    },
                    {
                        question: "Pregnant patient develops respiratory failure from influenza. ED management?",
                        options: ["Avoid intubation", "Standard ventilator settings", "Lung protective ventilation", "ECMO immediately"],
                        correct: 2,
                        explanation: "Pregnancy with ARDS: lung protective ventilation with lower tidal volumes to prevent barotrauma."
                    }
                ]
            },
            // Emergency Toxicology (5 cases)
            {
                id: 41,
                category: "Emergency Toxicology - Acetaminophen Overdose",
                urgency: "high",
                presentation: "19F college student brought by friends after intentional overdose 6 hours ago. Took 'entire bottle' of Tylenol. Initially asymptomatic, now nauseous.",
                vitals: "BP: 120/80, HR: 88, RR: 16, O2: 98% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Acetaminophen level drawn 8 hours post-ingestion is 180 mcg/mL. This indicates?",
                        options: ["Non-toxic level", "Possible hepatotoxicity", "Definite hepatotoxicity", "Need for liver transplant"],
                        correct: 2,
                        explanation: "Acetaminophen >150 mcg/mL at 4 hrs or >75 mcg/mL at 8 hrs indicates hepatotoxicity risk."
                    },
                    {
                        question: "Patient above treatment line on nomogram. ED antidote?",
                        options: ["Activated charcoal only", "N-acetylcysteine (NAC)", "Both charcoal and NAC", "Supportive care"],
                        correct: 2,
                        explanation: "Acetaminophen overdose: NAC is antidote. Charcoal if <1-2 hours post-ingestion."
                    }
                ]
            },
            {
                id: 42,
                category: "Emergency Toxicology - Salicylate Poisoning",
                urgency: "high",
                presentation: "45M chronic pain patient with altered mental status, tinnitus, hyperthermia. Takes aspirin daily. ABG shows mixed acid-base disorder.",
                vitals: "BP: 100/60, HR: 120, RR: 30, O2: 96% RA, Temp: 103.2°F",
                steps: [
                    {
                        question: "ABG shows pH 7.48, CO2 20, HCO3 14. This represents?",
                        options: ["Respiratory alkalosis only", "Metabolic acidosis only", "Mixed respiratory alkalosis and metabolic acidosis", "Normal values"],
                        correct: 2,
                        explanation: "Salicylate poisoning: mixed disorder with primary respiratory alkalosis + metabolic acidosis."
                    },
                    {
                        question: "Severe salicylate poisoning with altered mental status. ED treatment?",
                        options: ["Activated charcoal", "Sodium bicarbonate + hemodialysis", "Supportive care only", "NAC antidote"],
                        correct: 1,
                        explanation: "Severe salicylate poisoning: sodium bicarbonate + hemodialysis for CNS symptoms."
                    }
                ]
            },
            {
                id: 43,
                category: "Emergency Toxicology - Tricyclic Antidepressant Overdose",
                urgency: "high",
                presentation: "28M found down with empty amitriptyline bottle. Altered mental status, wide complex tachycardia on EKG, hypotension, seizure activity.",
                vitals: "BP: 80/50, HR: 150, RR: 12, O2: 94% BVM, Temp: 98.6°F",
                steps: [
                    {
                        question: "TCA overdose with wide complex tachycardia. First-line ED treatment?",
                        options: ["Lidocaine", "Sodium bicarbonate", "Cardioversion", "Flumazenil"],
                        correct: 1,
                        explanation: "TCA overdose with wide QRS: sodium bicarbonate narrows QRS and improves conduction."
                    },
                    {
                        question: "Target arterial pH for sodium bicarbonate therapy in TCA overdose?",
                        options: ["7.35-7.45", "7.45-7.55", "7.55-7.65", ">7.65"],
                        correct: 1,
                        explanation: "TCA overdose: target pH 7.45-7.55 with sodium bicarbonate to reverse cardiotoxicity."
                    }
                ]
            },
            {
                id: 44,
                category: "Emergency Toxicology - Opioid Overdose",
                urgency: "high",
                presentation: "32M found unconscious with pinpoint pupils and respiratory depression. Empty heroin bags found nearby. RR 6, minimal response to stimuli.",
                vitals: "BP: 100/60, HR: 60, RR: 6, O2: 78% RA, Temp: 96.8°F",
                steps: [
                    {
                        question: "Suspected opioid overdose with respiratory depression. Immediate ED treatment?",
                        options: ["Flumazenil", "Naloxone (Narcan)", "Intubation first", "IV stimulants"],
                        correct: 1,
                        explanation: "Opioid overdose: naloxone reverses respiratory depression. Start with 0.4-2mg IV/IM/IN."
                    },
                    {
                        question: "Patient responds to naloxone but becomes agitated and leaves AMA. ED concern?",
                        options: ["No further concern", "Re-overdose as naloxone wears off", "Withdrawal seizures", "Cardiac arrest"],
                        correct: 1,
                        explanation: "Naloxone half-life shorter than most opioids. Risk of re-overdose when naloxone wears off."
                    }
                ]
            },
            {
                id: 45,
                category: "Emergency Toxicology - Carbon Monoxide Poisoning",
                urgency: "high",
                presentation: "Family of 4 with headache, nausea, fatigue after using generator indoors during power outage. Cherry-red skin color noted in children.",
                vitals: "BP: 120/80, HR: 100, RR: 18, O2: 99% pulse ox, Temp: 98.6°F",
                steps: [
                    {
                        question: "Suspected CO poisoning with normal pulse oximetry. Next ED step?",
                        options: ["Discharge - normal O2 sat", "Arterial blood gas", "Carboxyhemoglobin level", "Chest X-ray"],
                        correct: 2,
                        explanation: "CO poisoning: pulse oximetry unreliable. Need carboxyhemoglobin level (normal <3%)."
                    },
                    {
                        question: "COHb level 25% in pregnant patient. ED treatment?",
                        options: ["Room air", "High-flow oxygen", "Hyperbaric oxygen", "Intubation"],
                        correct: 2,
                        explanation: "Severe CO poisoning or pregnancy: hyperbaric oxygen if available, otherwise 100% O2."
                    }
                ]
            },
            // Emergency Psychiatry (5 cases)
            {
                id: 46,
                category: "Emergency Psychiatry - Acute Psychosis",
                urgency: "medium",
                presentation: "24M brought by police for erratic behavior. Paranoid, agitated, responding to internal stimuli. No known psychiatric history. Recent methamphetamine use suspected.",
                vitals: "BP: 160/100, HR: 120, RR: 20, O2: 98% RA, Temp: 99.8°F",
                steps: [
                    {
                        question: "Agitated psychotic patient in ED. First priority?",
                        options: ["Psychiatric evaluation", "Medical clearance", "Chemical restraints", "Discharge planning"],
                        correct: 1,
                        explanation: "Acute psychosis: medical clearance first to rule out organic causes (drugs, metabolic, etc)."
                    },
                    {
                        question: "Patient requires chemical sedation for safety. Best ED option?",
                        options: ["Haloperidol alone", "Lorazepam alone", "Haloperidol + lorazepam", "Restraints only"],
                        correct: 2,
                        explanation: "Agitated psychosis: combination haloperidol + lorazepam more effective than either alone."
                    }
                ]
            },
            {
                id: 47,
                category: "Emergency Psychiatry - Suicidal Ideation",
                urgency: "high",
                presentation: "38F brought by family for depression and suicidal statements. Recent divorce, job loss. States plan to overdose on medications tonight. Cooperative but tearful.",
                vitals: "BP: 125/80, HR: 88, RR: 16, O2: 98% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Patient with active suicidal ideation and plan. ED management priority?",
                        options: ["Discharge with outpatient follow-up", "Voluntary psychiatric admission", "Involuntary hold for safety", "Crisis intervention only"],
                        correct: 2,
                        explanation: "Active suicidal ideation with plan: involuntary hold indicated for safety assessment."
                    },
                    {
                        question: "Suicidal patient requests to use bathroom alone. ED response?",
                        options: ["Allow privacy", "1:1 sitter accompanies", "Search for contraband first", "Refuse bathroom privileges"],
                        correct: 1,
                        explanation: "Suicidal patients require constant 1:1 observation, including bathroom visits."
                    }
                ]
            },
            {
                id: 48,
                category: "Emergency Psychiatry - Alcohol Withdrawal",
                urgency: "medium",
                presentation: "52M chronic alcoholic, last drink 2 days ago. Tremors, diaphoresis, anxiety, reports seeing bugs crawling on skin. Vital signs stable.",
                vitals: "BP: 140/90, HR: 105, RR: 18, O2: 96% RA, Temp: 99.2°F",
                steps: [
                    {
                        question: "Clinical presentation most consistent with?",
                        options: ["Alcohol intoxication", "Delirium tremens", "Alcohol withdrawal", "Psychiatric condition"],
                        correct: 2,
                        explanation: "Alcohol withdrawal: tremors, diaphoresis, anxiety, visual hallucinations 24-72 hrs after last drink."
                    },
                    {
                        question: "First-line ED treatment for alcohol withdrawal?",
                        options: ["Haloperidol", "Lorazepam", "Thiamine", "IV fluids"],
                        correct: 1,
                        explanation: "Alcohol withdrawal: benzodiazepines (lorazepam) first-line. Also give thiamine to prevent Wernicke's."
                    }
                ]
            },
            {
                id: 49,
                category: "Emergency Psychiatry - Panic Attack",
                urgency: "low",
                presentation: "29F acute onset chest pain, SOB, feeling of impending doom while at work. Palpitations, diaphoresis, tingling in hands. No cardiac history.",
                vitals: "BP: 140/85, HR: 110, RR: 24, O2: 99% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Young healthy patient with classic panic symptoms. ED approach?",
                        options: ["Psychiatric evaluation only", "Rule out medical causes first", "Discharge with reassurance", "Immediate anxiolytics"],
                        correct: 1,
                        explanation: "Panic attack symptoms overlap with medical emergencies. Rule out cardiac, pulmonary causes first."
                    },
                    {
                        question: "EKG and basic labs normal. Patient hyperventilating. ED treatment?",
                        options: ["Paper bag rebreathing", "Reassurance + breathing exercises", "Intubation", "Beta-blockers"],
                        correct: 1,
                        explanation: "Panic attack: reassurance, breathing exercises, explain hyperventilation physiology. Avoid paper bags."
                    }
                ]
            },
            {
                id: 50,
                category: "Emergency Psychiatry - Excited Delirium",
                urgency: "high",
                presentation: "35M agitated, hyperthermic, superhuman strength after cocaine use. Police restraints applied. Combative, incoherent, profusely diaphoretic.",
                vitals: "BP: 180/110, HR: 150, RR: 30, O2: 94% RA, Temp: 104.8°F",
                steps: [
                    {
                        question: "Excited delirium syndrome is characterized by?",
                        options: ["Hyperthermia + agitation + superhuman strength", "Depression and withdrawal", "Normal vital signs", "Cooperative behavior"],
                        correct: 0,
                        explanation: "Excited delirium: hyperthermia + extreme agitation + apparent superhuman strength + altered mental status."
                    },
                    {
                        question: "Patient in excited delirium with hyperthermia. ED priority?",
                        options: ["Psychiatric medications", "Aggressive cooling + sedation", "Physical restraints only", "Discharge planning"],
                        correct: 1,
                        explanation: "Excited delirium: life-threatening. Priorities are cooling + chemical sedation + airway protection."
                    }
                ]
            },
            // Emergency Pediatrics (5 cases)
            {
                id: 51,
                category: "Emergency Pediatrics - Febrile Seizure",
                urgency: "medium",
                presentation: "18-month-old brought by parents after 3-minute generalized seizure. Fever to 102.8°F with URI symptoms x2 days. Now alert, interactive.",
                vitals: "BP: 90/50, HR: 120, RR: 24, O2: 98% RA, Temp: 102.8°F, Weight: 12kg",
                steps: [
                    {
                        question: "Simple febrile seizure characteristics include?",
                        options: ["Duration >15 minutes", "Focal features", "Generalized, <15 minutes, no recurrence in 24 hrs", "Age >6 years"],
                        correct: 2,
                        explanation: "Simple febrile seizure: generalized, <15 minutes, no focal features, no recurrence in 24 hours."
                    },
                    {
                        question: "18-month-old with simple febrile seizure. ED workup needed?",
                        options: ["Lumbar puncture", "EEG", "No specific workup if typical", "MRI brain"],
                        correct: 2,
                        explanation: "Simple febrile seizure in 12-18 months: no routine workup needed if developmentally normal."
                    }
                ]
            },
            {
                id: 52,
                category: "Emergency Pediatrics - Croup",
                urgency: "medium",
                presentation: "2-year-old with barking cough, stridor, and fever x2 days. Worse at night. Seal-like cough, inspiratory stridor when agitated.",
                vitals: "BP: 85/45, HR: 110, RR: 28, O2: 94% RA, Temp: 100.8°F",
                steps: [
                    {
                        question: "Clinical presentation most consistent with?",
                        options: ["Epiglottitis", "Croup (laryngotracheobronchitis)", "Foreign body aspiration", "Asthma"],
                        correct: 1,
                        explanation: "Croup: barking cough + inspiratory stridor + gradual onset. Usually viral (parainfluenza)."
                    },
                    {
                        question: "Mild-moderate croup treatment in ED?",
                        options: ["Antibiotics", "Dexamethasone", "Epinephrine nebulizer", "Intubation"],
                        correct: 1,
                        explanation: "Croup: dexamethasone (oral or IM) reduces inflammation and shortens duration."
                    }
                ]
            },
            {
                id: 53,
                category: "Emergency Pediatrics - Bronchiolitis",
                urgency: "medium",
                presentation: "6-month-old with rhinorrhea, cough, wheezing x3 days. Feeding poorly, increased work of breathing. RSV season, appears tired.",
                vitals: "BP: 80/45, HR: 140, RR: 50, O2: 90% RA, Temp: 100.2°F",
                steps: [
                    {
                        question: "Bronchiolitis in infant is most commonly caused by?",
                        options: ["Streptococcus pneumoniae", "Respiratory syncytial virus (RSV)", "Influenza", "Parainfluenza"],
                        correct: 1,
                        explanation: "Bronchiolitis: RSV most common cause in infants <2 years, especially winter/spring."
                    },
                    {
                        question: "6-month-old with bronchiolitis and O2 sat 90%. ED treatment?",
                        options: ["Albuterol nebulizer", "Antibiotics", "Supportive care + oxygen", "Steroids"],
                        correct: 2,
                        explanation: "Bronchiolitis: supportive care (oxygen, fluids, suctioning). Bronchodilators not effective."
                    }
                ]
            },
            {
                id: 54,
                category: "Emergency Pediatrics - Intussusception",
                urgency: "high",
                presentation: "9-month-old with sudden onset colicky abdominal pain. Drawing legs up, inconsolable crying episodes. Vomiting, bloody 'currant jelly' stool.",
                vitals: "BP: 85/50, HR: 130, RR: 26, O2: 96% RA, Temp: 99.8°F",
                steps: [
                    {
                        question: "Classic triad of intussusception includes?",
                        options: ["Fever, vomiting, diarrhea", "Colicky pain, vomiting, bloody stool", "Cough, fever, rash", "Seizures, fever, rash"],
                        correct: 1,
                        explanation: "Intussusception triad: colicky abdominal pain + vomiting + bloody 'currant jelly' stools."
                    },
                    {
                        question: "Suspected intussusception in stable infant. ED imaging of choice?",
                        options: ["CT abdomen", "Ultrasound abdomen", "Plain abdominal X-rays", "MRI"],
                        correct: 1,
                        explanation: "Intussusception: ultrasound first-line imaging. Shows 'target sign' or 'donut sign'."
                    }
                ]
            },
            {
                id: 55,
                category: "Emergency Pediatrics - Kawasaki Disease",
                urgency: "medium",
                presentation: "3-year-old with 5 days of high fever, rash, red eyes, swollen hands/feet, strawberry tongue, cervical lymphadenopathy.",
                vitals: "BP: 90/55, HR: 125, RR: 24, O2: 98% RA, Temp: 103.4°F",
                steps: [
                    {
                        question: "Clinical criteria for Kawasaki disease include how many of the following: fever >5 days, rash, conjunctivitis, oral changes, extremity changes, lymphadenopathy?",
                        options: ["2 criteria + fever", "3 criteria + fever", "4 criteria + fever", "All 5 criteria + fever"],
                        correct: 2,
                        explanation: "Kawasaki disease: fever ≥5 days + ≥4 of 5 criteria (rash, conjunctivitis, oral, extremities, lymph nodes)."
                    },
                    {
                        question: "Treatment for Kawasaki disease to prevent coronary complications?",
                        options: ["Antibiotics", "Steroids", "IVIG + aspirin", "Supportive care only"],
                        correct: 2,
                        explanation: "Kawasaki disease: IVIG + high-dose aspirin to prevent coronary artery aneurysms."
                    }
                ]
            },
            // Emergency Obstetrics/Gynecology (5 cases)
            {
                id: 56,
                category: "Emergency OB/GYN - Ectopic Pregnancy",
                urgency: "high",
                presentation: "28F 6 weeks pregnant with sudden onset severe right lower abdominal pain. Vaginal bleeding, lightheaded. Last menstrual period 6 weeks ago.",
                vitals: "BP: 95/60, HR: 110, RR: 20, O2: 98% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "First-trimester bleeding with abdominal pain. ED priority assessment?",
                        options: ["Pelvic exam", "Quantitative β-hCG", "Transvaginal ultrasound", "CBC"],
                        correct: 2,
                        explanation: "Suspected ectopic pregnancy: transvaginal ultrasound to locate pregnancy and assess for rupture."
                    },
                    {
                        question: "Ultrasound shows free fluid in pelvis, no intrauterine pregnancy. β-hCG 2000. Most likely diagnosis?",
                        options: ["Normal early pregnancy", "Miscarriage", "Ruptured ectopic pregnancy", "Ovarian cyst"],
                        correct: 2,
                        explanation: "β-hCG >1500-2000 without intrauterine pregnancy + free fluid = ruptured ectopic pregnancy."
                    }
                ]
            },
            {
                id: 57,
                category: "Emergency OB/GYN - Ovarian Torsion",
                urgency: "high",
                presentation: "22F sudden onset severe right pelvic pain while exercising. Pain 10/10, nausea, vomiting. History of ovarian cysts. Pain constant, not improving.",
                vitals: "BP: 120/80, HR: 105, RR: 20, O2: 98% RA, Temp: 99.2°F",
                steps: [
                    {
                        question: "Sudden severe pelvic pain in young woman suggests?",
                        options: ["Appendicitis", "Ovarian torsion", "Kidney stone", "UTI"],
                        correct: 1,
                        explanation: "Sudden onset severe pelvic pain + nausea in young woman with ovarian cysts = torsion until proven otherwise."
                    },
                    {
                        question: "Suspected ovarian torsion. ED imaging of choice?",
                        options: ["CT abdomen/pelvis", "Transvaginal ultrasound with Doppler", "MRI pelvis", "Plain X-rays"],
                        correct: 1,
                        explanation: "Ovarian torsion: pelvic ultrasound with Doppler to assess ovarian blood flow."
                    }
                ]
            },
            {
                id: 58,
                category: "Emergency OB/GYN - Preeclampsia",
                urgency: "high",
                presentation: "32F at 34 weeks gestation with headache, visual changes, and epigastric pain. BP elevated at prenatal visit. Protein in urine.",
                vitals: "BP: 170/110, HR: 88, RR: 18, O2: 96% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Severe features of preeclampsia include?",
                        options: ["BP >140/90", "Proteinuria", "BP >160/110 + symptoms", "Mild edema"],
                        correct: 2,
                        explanation: "Severe preeclampsia: BP ≥160/110 + symptoms (headache, vision changes, epigastric pain)."
                    },
                    {
                        question: "Severe preeclampsia at 34 weeks. ED management priority?",
                        options: ["Immediate delivery", "Magnesium sulfate + antihypertensives", "Observation only", "Diuretics"],
                        correct: 1,
                        explanation: "Severe preeclampsia: magnesium for seizure prophylaxis + antihypertensives + delivery planning."
                    }
                ]
            },
            {
                id: 59,
                category: "Emergency OB/GYN - Precipitous Delivery",
                urgency: "high",
                presentation: "26F G2P1 at 38 weeks with strong contractions every 2 minutes. Feels urge to push. Previous rapid delivery. Crowning visible.",
                vitals: "BP: 125/80, HR: 95, RR: 20, O2: 98% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Patient crowning in ED. Immediate priority?",
                        options: ["Transfer to L&D", "Prepare for emergency delivery in ED", "Stop the delivery", "Give tocolytics"],
                        correct: 1,
                        explanation: "Crowning = imminent delivery. Prepare for emergency delivery in ED, don't attempt transport."
                    },
                    {
                        question: "During emergency delivery, shoulder dystocia occurs. ED maneuver?",
                        options: ["Pull harder on head", "McRoberts maneuver", "Cesarean section", "Use forceps"],
                        correct: 1,
                        explanation: "Shoulder dystocia: McRoberts maneuver (hyperflex hips) + suprapubic pressure first-line."
                    }
                ]
            },
            {
                id: 60,
                category: "Emergency OB/GYN - Postpartum Hemorrhage",
                urgency: "high",
                presentation: "29F delivered 2 hours ago, now with heavy vaginal bleeding. Estimated blood loss >500mL. Uterus feels soft and boggy on palpation.",
                vitals: "BP: 90/60, HR: 115, RR: 22, O2: 96% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Most common cause of postpartum hemorrhage?",
                        options: ["Retained placenta", "Uterine atony", "Cervical laceration", "Coagulopathy"],
                        correct: 1,
                        explanation: "Uterine atony (soft, boggy uterus) causes ~70% of postpartum hemorrhages."
                    },
                    {
                        question: "First-line treatment for uterine atony?",
                        options: ["Hysterectomy", "Uterine massage + oxytocin", "Blood transfusion", "Observation"],
                        correct: 1,
                        explanation: "Uterine atony: bimanual uterine massage + oxytocin to stimulate uterine contractions."
                    }
                ]
            }
        ];

        class EmCaseTrainer {
            constructor() {
                this.currentCase = 0;
                this.step = 0;
                this.selectedAnswers = {};
                this.showExplanation = false;
                this.score = { correct: 0, total: 0 };
                this.sessionStats = this.loadSessionStats();
                this.currentFilter = 'all';
                this.questionTimer = Date.now();
                this.render();
            }

            loadSessionStats() {
                if (!this.memoryStats) {
                    this.memoryStats = {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        categoryStats: {},
                        averageTime: 0,
                        longestStreak: 0,
                        currentStreak: 0
                    };
                }
                return this.memoryStats;
            }

            saveSessionStats() {
                this.memoryStats = { ...this.sessionStats };
            }

            resetStats() {
                this.sessionStats = {
                    totalQuestions: 0,
                    correctAnswers: 0,
                    categoryStats: {},
                    averageTime: 0,
                    longestStreak: 0,
                    currentStreak: 0
                };
                this.score = { correct: 0, total: 0 };
                this.memoryStats = { ...this.sessionStats };
                this.render();
            }

            getFilteredCases() {
                if (this.currentFilter === 'all') return defaultCases;
                return defaultCases.filter(c => c.category.toLowerCase().includes(this.currentFilter.toLowerCase()));
            }

            getCategories() {
                const categories = [...new Set(defaultCases.map(c => c.category.split(' - ')[0]))];
                return ['all', ...categories.sort()];
            }
            
            getCurrentCase() { 
                const filteredCases = this.getFilteredCases();
                return filteredCases[this.currentCase] || null; 
            }
            
            getCurrentStep() { 
                const currentCase = this.getCurrentCase(); 
                return currentCase && currentCase.steps ? currentCase.steps[this.step] : null; 
            }
            
            handleAnswer(answerIndex) {
                const key = `${this.currentCase}-${this.step}`;
                this.selectedAnswers[key] = answerIndex;
                const step = this.getCurrentStep();
                const currentCase = this.getCurrentCase();
                
                if (!step || !currentCase) return;
                
                const isCorrect = answerIndex === step.correct;
                const questionTime = (Date.now() - this.questionTimer) / 1000;
                
                this.sessionStats.totalQuestions++;
                if (isCorrect) {
                    this.sessionStats.correctAnswers++;
                    this.sessionStats.currentStreak++;
                    if (this.sessionStats.currentStreak > this.sessionStats.longestStreak) {
                        this.sessionStats.longestStreak = this.sessionStats.currentStreak;
                    }
                } else {
                    this.sessionStats.currentStreak = 0;
                }
                
                const category = currentCase.category.split(' - ')[0];
                if (!this.sessionStats.categoryStats[category]) {
                    this.sessionStats.categoryStats[category] = { correct: 0, total: 0 };
                }
                this.sessionStats.categoryStats[category].total++;
                if (isCorrect) {
                    this.sessionStats.categoryStats[category].correct++;
                }
                
                this.sessionStats.averageTime = ((this.sessionStats.averageTime * (this.sessionStats.totalQuestions - 1)) + questionTime) / this.sessionStats.totalQuestions;
                
                if (isCorrect) {
                    this.score.correct++;
                }
                this.score.total++;
                this.showExplanation = true;
                this.saveSessionStats();
                this.render();
            }
            
            nextStep() {
                const filteredCases = this.getFilteredCases();
                const currentCase = this.getCurrentCase();
                if (!currentCase) return;
                
                if (this.step < currentCase.steps.length - 1) {
                    this.step++;
                } else {
                    this.nextCase();
                }
                this.showExplanation = false;
                this.questionTimer = Date.now();
                this.render();
            }
            
            nextCase() {
                const filteredCases = this.getFilteredCases();
                if (this.currentCase < filteredCases.length - 1) {
                    this.currentCase++;
                    this.step = 0;
                } else {
                    this.currentCase = 0;
                    this.step = 0;
                }
                this.showExplanation = false;
                this.questionTimer = Date.now();
                this.render();
            }

            setFilter(filter) {
                this.currentFilter = filter;
                this.currentCase = 0;
                this.step = 0;
                this.showExplanation = false;
                this.questionTimer = Date.now();
                this.render();
            }
            
            render() {
                const app = document.getElementById('app');
                const currentCase = this.getCurrentCase();
                const currentStep = this.getCurrentStep();
                
                if (!currentCase) {
                    app.innerHTML = '<div class="content"><p>No cases available for the selected filter</p></div>';
                    return;
                }
                
                app.innerHTML = this.renderCase(currentCase, currentStep);
            }

            renderStats() {
                const accuracy = this.sessionStats.totalQuestions > 0 ? 
                    Math.round((this.sessionStats.correctAnswers / this.sessionStats.totalQuestions) * 100) : 0;
                
                return `
                    <div class="stats-panel">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">${accuracy}%</div>
                                <div class="stat-label">Accuracy</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${this.sessionStats.totalQuestions}</div>
                                <div class="stat-label">Questions</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${this.sessionStats.longestStreak}</div>
                                <div class="stat-label">Best Streak</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${Math.round(this.sessionStats.averageTime)}s</div>
                                <div class="stat-label">Avg Time</div>
                            </div>
                        </div>
                        <button class="reset-stats" onclick="app.resetStats()">Reset Session Stats</button>
                    </div>
                `;
            }

            renderFilters() {
                const categories = this.getCategories();
                return `
                    <div class="category-filter">
                        ${categories.map(cat => `
                            <button class="filter-chip ${this.currentFilter === cat ? 'active' : ''}" 
                                    onclick="app.setFilter('${cat}')">
                                ${cat === 'all' ? `All Cases (${defaultCases.length})` : cat.replace('Emergency ', '')}
                            </button>
                        `).join('')}
                    </div>
                `;
            }
            
            renderCase(currentCase, currentStep) {
                const filteredCases = this.getFilteredCases();
                const progressBars = currentCase.steps.map((_, i) => 
                    `<div class="progress-bar ${i <= this.step ? 'active' : ''}"></div>`
                ).join('');
                
                const selectedAnswer = this.selectedAnswers[`${this.currentCase}-${this.step}`];
                const questionTime = Math.round((Date.now() - this.questionTimer) / 1000);
                
                const options = currentStep ? currentStep.options.map((option, i) => {
                    let className = 'option';
                    if (this.showExplanation) {
                        if (i === currentStep.correct) {
                            className += ' correct-answer';
                        } else if (i === selectedAnswer && i !== currentStep.correct) {
                            className += ' incorrect';
                        }
                    }
                    
                    return `
                        <button class="${className}" 
                                onclick="app.handleAnswer(${i})" 
                                ${this.showExplanation ? 'disabled' : ''}>
                            ${option}
                        </button>
                    `;
                }).join('') : '';
                
                return `
                    <div class="header">
                        <div class="header-top">
                            <div class="header-left">
                                <div class="logo">
                                    <svg viewBox="0 0 450 100" xmlns="http://www.w3.org/2000/svg">
                                        <!-- Medical briefcase -->
                                        <g transform="translate(10, 5)">
                                            <!-- Handle -->
                                            <rect x="30" y="-6" width="35" height="7" rx="3.5" fill="none" stroke="white" stroke-width="3"/>
                                            <!-- Handle supports -->
                                            <rect x="26" y="-1" width="7" height="14" rx="2" fill="white"/>
                                            <rect x="62" y="-1" width="7" height="14" rx="2" fill="white"/>
                                            
                                            <!-- Main briefcase body -->
                                            <rect x="0" y="12" width="95" height="56" rx="7" fill="none" stroke="white" stroke-width="3"/>
                                            
                                            <!-- Latches -->
                                            <rect x="-5" y="25" width="10" height="7" rx="2" fill="white"/>
                                            <rect x="90" y="25" width="10" height="7" rx="2" fill="white"/>
                                            <rect x="-5" y="45" width="10" height="7" rx="2" fill="white"/>
                                            <rect x="90" y="45" width="10" height="7" rx="2" fill="white"/>
                                            
                                            <!-- Medical cross in circle -->
                                            <circle cx="47.5" cy="40" r="18" fill="white"/>
                                            <circle cx="47.5" cy="40" r="16" fill="none" stroke="#dc2626" stroke-width="2"/>
                                            <!-- Cross -->
                                            <rect x="44" y="30" width="7" height="20" fill="#dc2626"/>
                                            <rect x="37.5" y="36.5" width="20" height="7" fill="#dc2626"/>
                                        </g>
                                        
                                        <!-- Text -->
                                        <text x="130" y="45" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="white">emergency</text>
                                        <text x="130" y="75" font-family="Arial, sans-serif" font-size="28" font-weight="300" fill="white">briefcase</text>
                                    </svg>
                                </div>
                            </div>
                            <div class="header-right">
                                <div class="score">${this.score.correct}/${this.score.total}</div>
                                <div class="timer">${questionTime}s</div>
                            </div>
                        </div>
                        <div class="header-info">
                            <span class="urgency ${currentCase.urgency}">${currentCase.urgency.toUpperCase()}</span>
                            <span>Case ${this.currentCase + 1}/${filteredCases.length}</span>
                            <span>Step ${this.step + 1}/${currentCase.steps.length}</span>
                        </div>
                    </div>
                    
                    <div class="content">
                        ${this.renderStats()}
                        ${this.renderFilters()}
                        
                        <div class="case-header">
                            <div class="case-title">${currentCase.category}</div>
                            <div class="presentation">${currentCase.presentation}</div>
                            <div class="vitals">
                                <div class="vitals-label">VITAL SIGNS</div>
                                <div class="vitals-text">${currentCase.vitals}</div>
                            </div>
                        </div>
                        
                        <div class="progress">${progressBars}</div>
                        
                        ${currentStep ? `
                            <div class="question">
                                <div class="question-title">${currentStep.question}</div>
                                <div class="options">${options}</div>
                            </div>
                            
                            ${this.showExplanation ? `
                                <div class="explanation">
                                    <div class="explanation-label">EXPLANATION</div>
                                    <div class="explanation-text">${currentStep.explanation}</div>
                                </div>
                                
                                <div class="actions">
                                    <button class="btn btn-primary" onclick="app.nextStep()">
                                        ${this.step < currentCase.steps.length - 1 ? 'Next Question' : 'Next Case'} →
                                    </button>
                                </div>
                            ` : ''}
                        ` : ''}
                    </div>
                `;
            }
        }

        // Initialize the app
        const app = new EmCaseTrainer();
    </script>
</body>
</html>