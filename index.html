<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Briefcase</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }
        
        .header {
            background: #dc2626;
            color: white;
            padding: 16px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .score {
            background: #991b1b;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .header-info {
            font-size: 14px;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .urgency {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .urgency.high { background: #fef2f2; color: #dc2626; }
        .urgency.medium { background: #fefce8; color: #ca8a04; }
        .urgency.low { background: #f0fdf4; color: #16a34a; }
        
        .content {
            padding: 16px;
        }
        
        .case-header {
            margin-bottom: 16px;
        }
        
        .case-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .presentation {
            background: #f9fafb;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .vitals {
            background: #eff6ff;
            padding: 12px;
            border-radius: 8px;
        }
        
        .vitals-label {
            font-size: 12px;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 4px;
        }
        
        .vitals-text {
            font-size: 14px;
            color: #1e40af;
        }
        
        .progress {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .progress-bar {
            height: 8px;
            flex: 1;
            border-radius: 4px;
            background: #e5e7eb;
        }
        
        .progress-bar.active {
            background: #dc2626;
        }
        
        .question {
            margin-bottom: 16px;
        }
        
        .question-title {
            font-weight: 500;
            margin-bottom: 12px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .option {
            width: 100%;
            padding: 12px;
            text-align: left;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .option:hover:not(:disabled) {
            background: #fef2f2;
            border-color: #dc2626;
        }
        
        .option.correct {
            background: #f0fdf4;
            border-color: #16a34a;
            color: #15803d;
        }
        
        .option.incorrect {
            background: #fef2f2;
            border-color: #dc2626;
            color: #dc2626;
        }
        
        .option.correct-answer {
            background: #f0fdf4;
            border-color: #16a34a;
            color: #15803d;
        }
        
        .option:disabled {
            cursor: default;
        }
        
        .explanation {
            background: #eff6ff;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        .explanation-label {
            font-size: 12px;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 4px;
        }
        
        .explanation-text {
            font-size: 14px;
            color: #1e40af;
            line-height: 1.5;
        }
        
        .actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #dc2626;
            color: white;
        }
        
        .btn-primary:hover {
            background: #991b1b;
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .admin-toggle {
            background: none;
            border: none;
            color: white;
            padding: 4px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .admin-toggle:hover {
            background: #991b1b;
        }
        
        .admin-panel {
            background: #4b5563;
            color: white;
            padding: 16px;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .case-item {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            background: white;
            color: #333;
        }
        
        .case-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
        }
        
        .btn-edit {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .btn-delete {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .btn-add {
            background: #dc2626;
            color: white;
            margin-bottom: 16px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
            color: #374151;
        }
        
        .form-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }
        
        .step-editor {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .option-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .option-radio {
            margin: 0;
        }
        
        .option-input {
            flex: 1;
            padding: 6px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="app"></div>
    </div>

    <script>
        class EmCaseTrainer {
            constructor() {
                this.currentCase = 0;
                this.step = 0;
                this.selectedAnswers = {};
                this.showExplanation = false;
                this.score = { correct: 0, total: 0 };
                this.showAdmin = false;
                this.editingCase = null;
                this.isAuthenticated = false;
                this.adminPassword = "EM2024!"; // Change this to your preferred password
                
                this.defaultCases = [
                    {
                        id: 1,
                        category: "Chest Pain",
                        urgency: "high",
                        presentation: "67M presents with crushing chest pain radiating to left arm. Started 45 min ago while watching TV. Diaphoretic, anxious.",
                        vitals: "BP: 160/95, HR: 102, RR: 22, O2: 96% RA, Temp: 98.6¬∞F",
                        steps: [
                            {
                                question: "Most likely diagnosis?",
                                options: ["GERD", "Anxiety", "STEMI", "Pulmonary embolism"],
                                correct: 2,
                                explanation: "Classic presentation of STEMI: crushing chest pain, radiation, diaphoresis, and demographics."
                            },
                            {
                                question: "First intervention?",
                                options: ["IV access", "12-lead EKG", "Chest X-ray", "Nitroglycerin"],
                                correct: 1,
                                explanation: "12-lead EKG within 10 minutes is the priority to confirm STEMI and guide treatment."
                            },
                            {
                                question: "If EKG shows ST elevation in V2-V4, next step?",
                                options: ["Heparin only", "Cath lab activation", "Thrombolytics", "Aspirin and observe"],
                                correct: 1,
                                explanation: "Anterior STEMI requires immediate cath lab activation for primary PCI within 90 minutes."
                            }
                        ]
                    },
                    {
                        id: 2,
                        category: "Shortness of Breath",
                        urgency: "high",
                        presentation: "34F with sudden onset severe dyspnea and sharp chest pain. Recently returned from Europe. No fever.",
                        vitals: "BP: 100/60, HR: 118, RR: 28, O2: 88% RA, Temp: 98.2¬∞F",
                        steps: [
                            {
                                question: "Top differential diagnosis?",
                                options: ["Pneumonia", "Asthma exacerbation", "Pulmonary embolism", "Panic attack"],
                                correct: 2,
                                explanation: "Recent travel + sudden dyspnea + chest pain + tachycardia = PE until proven otherwise."
                            },
                            {
                                question: "Most appropriate imaging?",
                                options: ["Chest X-ray", "CT angiogram", "V/Q scan", "Echocardiogram"],
                                correct: 1,
                                explanation: "CTPA is first-line for PE diagnosis in hemodynamically stable patients with adequate renal function."
                            },
                            {
                                question: "While awaiting imaging, best initial treatment?",
                                options: ["Albuterol", "Heparin", "Morphine", "Wait for results"],
                                correct: 1,
                                explanation: "High clinical suspicion for PE warrants immediate anticoagulation unless contraindicated."
                            }
                        ]
                    },
                    {
                        id: 3,
                        category: "Trauma",
                        urgency: "high",
                        presentation: "22M motorcycle vs car accident. Restless, pale. Complains of severe abdominal pain. Seatbelt mark across abdomen.",
                        vitals: "BP: 90/60, HR: 120, RR: 24, O2: 94% RA, Temp: 97.8¬∞F",
                        steps: [
                            {
                                question: "Primary concern based on mechanism?",
                                options: ["Femur fracture", "Head injury", "Intra-abdominal bleeding", "Pneumothorax"],
                                correct: 2,
                                explanation: "Hypotension + tachycardia + abdominal pain + mechanism = concerning for intra-abdominal hemorrhage."
                            },
                            {
                                question: "Initial imaging priority?",
                                options: ["CT head", "FAST exam", "Chest X-ray", "Pelvis X-ray"],
                                correct: 1,
                                explanation: "FAST exam quickly identifies free fluid/hemorrhage in unstable trauma patients."
                            },
                            {
                                question: "If FAST is positive and patient remains hypotensive?",
                                options: ["CT abdomen", "OR immediately", "More IV fluids", "Blood transfusion only"],
                                correct: 1,
                                explanation: "Positive FAST + hemodynamic instability = immediate surgical exploration, no delay for CT."
                            }
                        ]
                    },
                    {
                        id: 4,
                        category: "Stroke/Neuro",
                        urgency: "high",
                        presentation: "72F brought by daughter for sudden onset left-sided weakness and slurred speech. Symptoms started 2 hours ago. History of afib, not on anticoagulation.",
                        vitals: "BP: 185/95, HR: 88 irregular, RR: 18, O2: 96% RA, Temp: 98.2¬∞F",
                        steps: [
                            {
                                question: "Most likely diagnosis?",
                                options: ["Hemorrhagic stroke", "Ischemic stroke", "Seizure", "Hypoglycemia"],
                                correct: 1,
                                explanation: "Acute focal neurologic deficits + atrial fibrillation = high suspicion for ischemic stroke from cardioembolism."
                            },
                            {
                                question: "First diagnostic test?",
                                options: ["MRI brain", "CT head without contrast", "Carotid ultrasound", "EKG"],
                                correct: 1,
                                explanation: "Non-contrast CT head rapidly excludes hemorrhage and helps determine thrombolytic eligibility."
                            },
                            {
                                question: "Patient is within time window, CT shows no hemorrhage. Next step?",
                                options: ["Aspirin 325mg", "tPA administration", "Clopidogrel", "Heparin drip"],
                                correct: 1,
                                explanation: "IV tPA within 4.5 hours for eligible patients with acute ischemic stroke improves outcomes."
                            }
                        ]
                    },
                    {
                        id: 5,
                        category: "Cardiac Arrest",
                        urgency: "high",
                        presentation: "58M collapsed at gym. Bystander CPR started immediately. EMS arrived in 8 minutes, patient in VF on monitor.",
                        vitals: "Pulseless, apneic",
                        steps: [
                            {
                                question: "First intervention after confirming arrest?",
                                options: ["Epinephrine 1mg", "Defibrillation", "Amiodarone 300mg", "Atropine 1mg"],
                                correct: 1,
                                explanation: "VF/VT is a shockable rhythm. Immediate defibrillation is the priority intervention."
                            },
                            {
                                question: "After 2 minutes of CPR, still in VF. Next step?",
                                options: ["Continue CPR only", "Second shock + epinephrine", "Amiodarone", "Check pulse"],
                                correct: 1,
                                explanation: "Second shock followed by epinephrine 1mg IV/IO after second shock per ACLS protocol."
                            },
                            {
                                question: "After 4 shocks and 2 epinephrine doses, still in VF. Consider?",
                                options: ["More epinephrine", "Amiodarone 300mg", "Lidocaine", "Stopping resuscitation"],
                                correct: 1,
                                explanation: "Amiodarone 300mg IV/IO for refractory VF/VT after adequate shocks and epinephrine."
                            }
                        ]
                    },
                    {
                        id: 6,
                        category: "Sepsis",
                        urgency: "high",
                        presentation: "78F nursing home resident with altered mental status x 1 day. Increased confusion, decreased oral intake. Staff reports foul-smelling urine.",
                        vitals: "BP: 82/45, HR: 118, RR: 28, O2: 91% RA, Temp: 102.4¬∞F",
                        steps: [
                            {
                                question: "This presentation meets criteria for?",
                                options: ["SIRS", "Sepsis", "Septic shock", "UTI only"],
                                correct: 2,
                                explanation: "Hypotension + altered mental status + suspected infection = septic shock requiring immediate intervention."
                            },
                            {
                                question: "First priority intervention?",
                                options: ["Blood cultures", "30mL/kg IV fluid bolus", "Antibiotics", "Urinalysis"],
                                correct: 1,
                                explanation: "Septic shock requires immediate fluid resuscitation - 30mL/kg (usually 2-3L) within first hour."
                            },
                            {
                                question: "Antibiotic timing goal in septic shock?",
                                options: ["Within 6 hours", "Within 3 hours", "Within 1 hour", "After culture results"],
                                correct: 2,
                                explanation: "Surviving Sepsis Campaign recommends antibiotics within 1 hour for septic shock patients."
                            }
                        ]
                    },
                    {
                        id: 7,
                        category: "Pediatric Emergency",
                        urgency: "high",
                        presentation: "2-year-old brought by parents for difficulty breathing and barking cough x 2 days. Worse at night. Low-grade fever. No drooling.",
                        vitals: "BP: 90/55, HR: 140, RR: 36, O2: 94% RA, Temp: 100.8¬∞F",
                        steps: [
                            {
                                question: "Most likely diagnosis?",
                                options: ["Epiglottitis", "Croup", "Foreign body aspiration", "Pneumonia"],
                                correct: 1,
                                explanation: "Barking cough + stridor + gradual onset + low fever = classic viral croup (laryngotracheobronchitis)."
                            },
                            {
                                question: "First-line treatment?",
                                options: ["Albuterol nebulizer", "Dexamethasone", "Racemic epinephrine", "Antibiotics"],
                                correct: 1,
                                explanation: "Dexamethasone 0.6mg/kg (max 10mg) reduces inflammation and symptom duration in croup."
                            },
                            {
                                question: "If child has severe stridor at rest, add?",
                                options: ["Heliox", "Racemic epinephrine", "Intubation", "More steroids"],
                                correct: 1,
                                explanation: "Racemic epinephrine nebulizer for severe croup with stridor at rest provides rapid symptom relief."
                            }
                        ]
                    },
                    {
                        id: 8,
                        category: "Psychiatric Emergency",
                        urgency: "high",
                        presentation: "28M brought by police for agitation and bizarre behavior. Hypervigilant, diaphoretic. Pupils dilated. Denies drug use but admits to 'not sleeping for 3 days'.",
                        vitals: "BP: 165/105, HR: 135, RR: 24, O2: 98% RA, Temp: 101.8¬∞F",
                        steps: [
                            {
                                question: "Most likely cause of presentation?",
                                options: ["Schizophrenia", "Stimulant intoxication", "Hyperthyroidism", "Mania"],
                                correct: 1,
                                explanation: "Agitation + hyperthermia + hypertension + mydriasis + sleep deprivation = stimulant toxidrome."
                            },
                            {
                                question: "Priority concern with hyperthermia?",
                                options: ["Seizures", "Rhabdomyolysis", "Dehydration", "All of the above"],
                                correct: 3,
                                explanation: "Stimulant-induced hyperthermia can cause seizures, rhabdomyolysis, and severe dehydration. Cooling is critical."
                            },
                            {
                                question: "Best initial sedation choice?",
                                options: ["Haloperidol", "Lorazepam", "Ketamine", "Olanzapine"],
                                correct: 1,
                                explanation: "Benzodiazepines are first-line for stimulant-induced agitation. Avoid antipsychotics (lower seizure threshold)."
                            }
                        ]
                    },
                    {
                        id: 9,
                        category: "Toxicology",
                        urgency: "high",
                        presentation: "19F college student found unconscious by roommate with empty acetaminophen bottle. Estimated ingestion 6 hours ago. Responsive to voice, vomited twice.",
                        vitals: "BP: 115/75, HR: 88, RR: 16, O2: 99% RA, Temp: 98.6¬∞F",
                        steps: [
                            {
                                question: "Most important initial lab?",
                                options: ["Liver enzymes", "Acetaminophen level", "Salicylate level", "ABG"],
                                correct: 1,
                                explanation: "Acetaminophen level at 4+ hours post-ingestion determines antidote need using Rumack-Matthew nomogram."
                            },
                            {
                                question: "Level drawn at 6 hours shows toxicity. Treatment?",
                                options: ["Activated charcoal", "N-acetylcysteine", "Hemodialysis", "Supportive care"],
                                correct: 1,
                                explanation: "N-acetylcysteine is the antidote for acetaminophen poisoning. Most effective within 8 hours of ingestion."
                            },
                            {
                                question: "NAC loading dose?",
                                options: ["70 mg/kg IV", "140 mg/kg PO", "150 mg/kg IV", "All are correct"],
                                correct: 3,
                                explanation: "NAC can be given PO (140 mg/kg) or IV (150 mg/kg loading dose). IV preferred for vomiting patients."
                            }
                        ]
                    },
                    {
                        id: 10,
                        category: "Shock",
                        urgency: "high",
                        presentation: "45M with 3-day history of chest pain, now presents with severe dyspnea. Unable to lie flat. Bilateral lower extremity edema. JVD present.",
                        vitals: "BP: 88/60, HR: 110, RR: 32, O2: 88% RA, Temp: 98.4¬∞F",
                        steps: [
                            {
                                question: "Type of shock most likely?",
                                options: ["Hypovolemic", "Cardiogenic", "Distributive", "Obstructive"],
                                correct: 1,
                                explanation: "CHF symptoms + hypotension + JVD + pulmonary edema = cardiogenic shock from pump failure."
                            },
                            {
                                question: "Immediate intervention priority?",
                                options: ["IV fluid bolus", "Norepinephrine", "BiPAP", "Furosemide"],
                                correct: 2,
                                explanation: "BiPAP improves oxygenation and reduces preload in acute cardiogenic pulmonary edema."
                            },
                            {
                                question: "If BiPAP improves breathing but BP remains low?",
                                options: ["More BiPAP", "Dobutamine", "Normal saline", "Nitroglycerin"],
                                correct: 1,
                                explanation: "Dobutamine increases contractility in cardiogenic shock. Avoid fluids (worsens pulmonary edema)."
                            }
                        ]
                    },
                    {
                        id: 11,
                        category: "Respiratory Emergency",
                        urgency: "high",
                        presentation: "55M with COPD history presents with worsening dyspnea x 2 days. Increased cough with purulent sputum. Using accessory muscles.",
                        vitals: "BP: 140/85, HR: 105, RR: 28, O2: 86% RA, Temp: 101.2¬∞F",
                        steps: [
                            {
                                question: "Most likely diagnosis?",
                                options: ["Pneumonia", "COPD exacerbation", "Pneumothorax", "Pulmonary embolism"],
                                correct: 1,
                                explanation: "COPD history + purulent sputum + fever + accessory muscle use = acute COPD exacerbation."
                            },
                            {
                                question: "First-line treatment?",
                                options: ["Albuterol + ipratropium", "Steroids", "Antibiotics", "BiPAP"],
                                correct: 0,
                                explanation: "Bronchodilators (albuterol + ipratropium) are first-line for acute COPD exacerbation."
                            },
                            {
                                question: "Patient not improving with bronchodilators. Next step?",
                                options: ["Intubation", "Prednisone 40mg", "BiPAP trial", "Magnesium sulfate"],
                                correct: 2,
                                explanation: "BiPAP reduces work of breathing and improves CO2 clearance in COPD exacerbation."
                            }
                        ]
                    },
                    {
                        id: 12,
                        category: "GI Emergency",
                        urgency: "high",
                        presentation: "68M with history of alcohol abuse presents with massive hematemesis. Appears pale and diaphoretic. Reports epigastric pain x 1 week.",
                        vitals: "BP: 95/55, HR: 125, RR: 22, O2: 95% RA, Temp: 98.0¬∞F",
                        steps: [
                            {
                                question: "Most likely source of bleeding?",
                                options: ["Peptic ulcer", "Esophageal varices", "Mallory-Weiss tear", "Boerhaave syndrome"],
                                correct: 1,
                                explanation: "Alcohol abuse + massive hematemesis + hemodynamic instability = esophageal varices until proven otherwise."
                            },
                            {
                                question: "Initial management priority?",
                                options: ["Urgent endoscopy", "Large bore IV access", "Octreotide", "Pantoprazole"],
                                correct: 1,
                                explanation: "Two large-bore IVs (16G or larger) for rapid volume resuscitation in major GI hemorrhage."
                            },
                            {
                                question: "If refractory bleeding from varices?",
                                options: ["More IV fluids", "Sengstaken-Blakemore tube", "Emergency surgery", "Higher PPI dose"],
                                correct: 1,
                                explanation: "Balloon tamponade (Sengstaken-Blakemore) can temporarily control variceal bleeding when endoscopy fails."
                            }
                        ]
                    },
                    {
                        id: 13,
                        category: "Infectious Disease",
                        urgency: "high",
                        presentation: "22F college student with severe headache, neck stiffness, and photophobia x 6 hours. Roommate had similar symptoms last week.",
                        vitals: "BP: 110/70, HR: 115, RR: 20, O2: 98% RA, Temp: 102.8¬∞F",
                        steps: [
                            {
                                question: "Most concerning diagnosis?",
                                options: ["Viral meningitis", "Bacterial meningitis", "Migraine", "Subarachnoid hemorrhage"],
                                correct: 1,
                                explanation: "Classic meningitis triad (headache, neck stiffness, fever) + close contact = bacterial meningitis concern."
                            },
                            {
                                question: "First intervention before lumbar puncture?",
                                options: ["CT head", "Blood cultures + antibiotics", "Dexamethasone", "IV fluids"],
                                correct: 1,
                                explanation: "Don't delay antibiotics for LP in suspected bacterial meningitis. Blood cultures then immediate antibiotics."
                            },
                            {
                                question: "Empiric antibiotic choice for this age group?",
                                options: ["Ampicillin + gentamicin", "Ceftriaxone + vancomycin", "Penicillin G", "Ceftazidime"],
                                correct: 1,
                                explanation: "Ceftriaxone + vancomycin covers S. pneumoniae and N. meningitidis in young adults."
                            }
                        ]
                    },
                    {
                        id: 14,
                        category: "Abdominal Pain",
                        urgency: "medium",
                        presentation: "35F with severe RUQ pain radiating to right shoulder. Pain started after eating fast food. Nausea and vomiting. Pain is colicky.",
                        vitals: "BP: 125/80, HR: 95, RR: 18, O2: 99% RA, Temp: 99.4¬∞F",
                        steps: [
                            {
                                question: "Most likely diagnosis?",
                                options: ["Acute cholecystitis", "Choledocholithiasis", "Hepatitis", "Peptic ulcer"],
                                correct: 0,
                                explanation: "RUQ pain + radiation to shoulder + triggered by fatty meal + Murphy's sign = acute cholecystitis."
                            },
                            {
                                question: "Best initial imaging?",
                                options: ["CT abdomen", "RUQ ultrasound", "HIDA scan", "MRCP"],
                                correct: 1,
                                explanation: "RUQ ultrasound is first-line for suspected gallbladder disease - evaluates stones, wall thickening, pericholecystic fluid."
                            },
                            {
                                question: "If ultrasound shows stones, wall thickening, positive Murphy's sign?",
                                options: ["Discharge with follow-up", "IV antibiotics", "Surgery consult", "Pain control only"],
                                correct: 2,
                                explanation: "Acute cholecystitis requires surgical consultation for cholecystectomy, preferably within 72 hours."
                            }
                        ]
                    },
                    {
                        id: 15,
                        category: "Syncope",
                        urgency: "medium",
                        presentation: "19F college athlete collapsed during basketball practice. Brief LOC, back to baseline quickly. No prodrome. Family history of sudden cardiac death in uncle at age 25.",
                        vitals: "BP: 118/75, HR: 58, RR: 16, O2: 99% RA, Temp: 98.6¬∞F",
                        steps: [
                            {
                                question: "Most concerning red flag?",
                                options: ["Young age", "Exertional syncope", "Family history", "Athletic activity"],
                                correct: 1,
                                explanation: "Exertional syncope in young athlete with family history of sudden death = high risk for hypertrophic cardiomyopathy."
                            },
                            {
                                question: "Essential initial test?",
                                options: ["Echocardiogram", "12-lead EKG", "Stress test", "Tilt table test"],
                                correct: 1,
                                explanation: "EKG screens for prolonged QT, Brugada pattern, delta waves, and signs of hypertrophic cardiomyopathy."
                            },
                            {
                                question: "If EKG shows deep Q waves in lateral leads?",
                                options: ["Discharge to primary care", "Cardiology consult", "Exercise restriction", "Echocardiogram stat"],
                                correct: 3,
                                explanation: "Deep Q waves + exertional syncope + family history = urgent echo to evaluate for hypertrophic cardiomyopathy."
                            }
                        ]
                    }
                ];
                
                this.loadCases();
                this.render();
            }
            
            loadCases() {
                try {
                    const saved = localStorage.getItem('emCases');
                    this.cases = saved ? JSON.parse(saved) : this.defaultCases;
                } catch {
                    this.cases = this.defaultCases;
                }
            }
            
            saveCases() {
                try {
                    localStorage.setItem('emCases', JSON.stringify(this.cases));
                } catch {
                    // Ignore storage errors
                }
            }
            
            getCurrentCase() {
                return this.cases[this.currentCase];
            }
            
            getCurrentStep() {
                const currentCase = this.getCurrentCase();
                return currentCase ? currentCase.steps[this.step] : null;
            }
            
            handleAnswer(answerIndex) {
                const questionKey = `${this.currentCase}-${this.step}`;
                this.selectedAnswers[questionKey] = answerIndex;
                
                const currentStep = this.getCurrentStep();
                if (answerIndex === currentStep.correct) {
                    this.score.correct++;
                }
                this.score.total++;
                
                this.showExplanation = true;
                this.render();
            }
            
            nextStep() {
                const currentCase = this.getCurrentCase();
                const isLastStep = this.step === currentCase.steps.length - 1;
                
                if (isLastStep) {
                    if (this.currentCase < this.cases.length - 1) {
                        this.currentCase++;
                        this.step = 0;
                    } else {
                        this.currentCase = 0;
                        this.step = 0;
                    }
                } else {
                    this.step++;
                }
                
                this.showExplanation = false;
                this.render();
            }
            
            resetCase() {
                this.step = 0;
                this.showExplanation = false;
                this.selectedAnswers = {};
                this.render();
            }
            
            toggleAdmin() {
                if (!this.isAuthenticated) {
                    this.showPasswordPrompt();
                } else {
                    this.showAdmin = !this.showAdmin;
                    this.editingCase = null;
                    this.render();
                }
            }
            
            showPasswordPrompt() {
                const password = prompt("Enter admin password to access case management:");
                if (password === this.adminPassword) {
                    this.isAuthenticated = true;
                    this.showAdmin = true;
                    this.render();
                } else if (password !== null) { // User didn't cancel
                    alert("Incorrect password. Access denied.");
                }
            }
            
            logout() {
                this.isAuthenticated = false;
                this.showAdmin = false;
                this.render();
            }
            
            addNewCase() {
                this.editingCase = {
                    id: 0,
                    category: "",
                    urgency: "medium",
                    presentation: "",
                    vitals: "",
                    steps: [{
                        question: "",
                        options: ["", "", "", ""],
                        correct: 0,
                        explanation: ""
                    }]
                };
                this.render();
            }
            
            editCase(caseItem) {
                this.editingCase = JSON.parse(JSON.stringify(caseItem));
                this.render();
            }
            
            deleteCase(caseId) {
                if (confirm('Are you sure you want to delete this case?')) {
                    this.cases = this.cases.filter(c => c.id !== caseId);
                    if (this.currentCase >= this.cases.length) {
                        this.currentCase = 0;
                        this.step = 0;
                    }
                    this.saveCases();
                    this.render();
                }
            }
            
            saveCase(formData) {
                if (!formData.category || !formData.presentation || !formData.vitals) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                for (let step of formData.steps) {
                    if (!step.question || step.options.some(opt => !opt) || !step.explanation) {
                        alert('Please complete all steps');
                        return;
                    }
                }
                
                if (formData.id === 0) {
                    formData.id = Math.max(...this.cases.map(c => c.id)) + 1;
                    this.cases.push(formData);
                } else {
                    const index = this.cases.findIndex(c => c.id === formData.id);
                    this.cases[index] = formData;
                }
                
                this.editingCase = null;
                this.saveCases();
                this.render();
            }
            
            cancelEdit() {
                this.editingCase = null;
                this.render();
            }
            
            render() {
                const app = document.getElementById('app');
                
                if (this.showAdmin) {
                    app.innerHTML = this.renderAdmin();
                    this.bindAdminEvents();
                } else {
                    app.innerHTML = this.renderTrainer();
                    this.bindTrainerEvents();
                }
            }
            
            renderTrainer() {
                const currentCase = this.getCurrentCase();
                const currentStep = this.getCurrentStep();
                
                if (!currentCase) {
                    return `
                        <div className="content">
                            <div style="text-align: center; margin-top: 80px;">
                                <p style="color: #6b7280; margin-bottom: 16px;">No cases available</p>
                                <button class="btn btn-primary" onclick="trainer.toggleAdmin()">Add Cases</button>
                            </div>
                        </div>
                    `;
                }
                
                const isLastStep = this.step === currentCase.steps.length - 1;
                
                return `
                    <div class="header">
                        <div class="header-top">
                            <div class="header-title">üíº Emergency Briefcase</div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <div class="score">Score: ${this.score.correct}/${this.score.total}</div>
                                <button class="admin-toggle" onclick="trainer.toggleAdmin()">‚öôÔ∏è</button>
                            </div>
                        </div>
                        <div class="header-info">
                            <span>üïê Case ${this.currentCase + 1} of ${this.cases.length}</span>
                            <span class="urgency ${currentCase.urgency}">${currentCase.urgency} priority</span>
                        </div>
                    </div>
                    
                    <div class="content">
                        <div class="case-header">
                            <h2 class="case-title">${currentCase.category}</h2>
                            <div class="presentation">${currentCase.presentation}</div>
                            <div class="vitals">
                                <div class="vitals-label">VITALS</div>
                                <div class="vitals-text">${currentCase.vitals}</div>
                            </div>
                        </div>
                        
                        <div class="progress">
                            ${currentCase.steps.map((_, index) => 
                                `<div class="progress-bar ${index <= this.step ? 'active' : ''}"></div>`
                            ).join('')}
                        </div>
                        
                        <div class="question">
                            <h3 class="question-title">Step ${this.step + 1}: ${currentStep.question}</h3>
                            <div class="options">
                                ${currentStep.options.map((option, index) => {
                                    const questionKey = `${this.currentCase}-${this.step}`;
                                    const isSelected = this.selectedAnswers[questionKey] === index;
                                    const isCorrect = index === currentStep.correct;
                                    const showResult = this.showExplanation;
                                    
                                    let className = 'option';
                                    let icon = '';
                                    
                                    if (showResult) {
                                        if (isSelected && isCorrect) {
                                            className += ' correct';
                                            icon = '‚úì';
                                        } else if (isSelected && !isCorrect) {
                                            className += ' incorrect';
                                            icon = '‚úó';
                                        } else if (isCorrect) {
                                            className += ' correct-answer';
                                            icon = '‚úì';
                                        }
                                    }
                                    
                                    return `
                                        <button class="${className}" 
                                                onclick="trainer.handleAnswer(${index})" 
                                                ${showResult ? 'disabled' : ''}>
                                            <span>${option}</span>
                                            ${icon ? `<span>${icon}</span>` : ''}
                                        </button>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        ${this.showExplanation ? `
                            <div class="explanation">
                                <div class="explanation-label">üìñ EXPLANATION</div>
                                <div class="explanation-text">${currentStep.explanation}</div>
                            </div>
                            
                            <div class="actions">
                                <button class="btn btn-primary" onclick="trainer.nextStep()">
                                    ${isLastStep ? 'Next Case' : 'Next Step'} ‚Üí
                                </button>
                                <button class="btn btn-secondary" onclick="trainer.resetCase()">
                                    üîÑ Reset Case
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            renderAdmin() {
                if (this.editingCase) {
                    return this.renderCaseEditor();
                }
                
                return `
                    <div class="admin-panel">
                        <div class="admin-header">
                            <h1>Case Management</h1>
                            <div style="display: flex; gap: 8px;">
                                <button class="admin-toggle" onclick="trainer.logout()" title="Logout">üö™</button>
                                <button class="admin-toggle" onclick="trainer.toggleAdmin()">‚úï</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="content">
                        <button class="btn btn-add" onclick="trainer.addNewCase()">‚ûï Add New Case</button>
                        
                        ${this.cases.map(caseItem => `
                            <div class="case-item">
                                <h3>${caseItem.category}</h3>
                                <p style="font-size: 14px; color: #6b7280; margin: 8px 0; line-height: 1.4;">${caseItem.presentation}</p>
                                <span class="urgency ${caseItem.urgency}">${caseItem.urgency} priority</span>
                                <div class="case-actions">
                                    <button class="btn-small btn-edit" onclick="trainer.editCase(${JSON.stringify(caseItem).replace(/"/g, '&quot;')})">‚úèÔ∏è Edit</button>
                                    <button class="btn-small btn-delete" onclick="trainer.deleteCase(${caseItem.id})">üóëÔ∏è Delete</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            renderCaseEditor() {
                const formData = this.editingCase;
                const isNew = formData.id === 0;
                
                return `
                    <div class="admin-panel">
                        <div class="admin-header">
                            <h1>${isNew ? 'New Case' : 'Edit Case'}</h1>
                            <div style="display: flex; gap: 8px;">
                                <button class="admin-toggle" onclick="trainer.logout()" title="Logout">üö™</button>
                                <button class="admin-toggle" onclick="trainer.cancelEdit()">‚úï</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="content">
                        <form id="caseForm" onsubmit="trainer.handleFormSubmit(event)">
                            <div class="form-group">
                                <label class="form-label">Category*</label>
                                <input type="text" class="form-input" name="category" value="${formData.category}" placeholder="e.g., Chest Pain, Trauma" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Urgency*</label>
                                <select class="form-input" name="urgency">
                                    <option value="low" ${formData.urgency === 'low' ? 'selected' : ''}>Low</option>
                                    <option value="medium" ${formData.urgency === 'medium' ? 'selected' : ''}>Medium</option>
                                    <option value="high" ${formData.urgency === 'high' ? 'selected' : ''}>High</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Presentation*</label>
                                <textarea class="form-textarea" name="presentation" placeholder="Patient presentation and chief complaint" required>${formData.presentation}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Vitals*</label>
                                <input type="text" class="form-input" name="vitals" value="${formData.vitals}" placeholder="BP: 120/80, HR: 85, RR: 16, O2: 99%, Temp: 98.6¬∞F" required>
                            </div>
                            
                            <div class="form-group">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <label class="form-label">Steps*</label>
                                    <button type="button" class="btn-small btn-add" onclick="trainer.addStep()">‚ûï Add Step</button>
                                </div>
                                
                                <div id="stepsContainer">
                                    ${formData.steps.map((step, stepIndex) => `
                                        <div class="step-editor" data-step="${stepIndex}">
                                            <div class="step-header">
                                                <span style="font-weight: 500;">Step ${stepIndex + 1}</span>
                                                ${formData.steps.length > 1 ? `<button type="button" class="btn-small btn-delete" onclick="trainer.removeStep(${stepIndex})">üóëÔ∏è</button>` : ''}
                                            </div>
                                            
                                            <div style="margin-bottom: 8px;">
                                                <input type="text" class="form-input" name="question_${stepIndex}" value="${step.question}" placeholder="Question" required>
                                            </div>
                                            
                                            ${step.options.map((option, optionIndex) => `
                                                <div class="option-row">
                                                    <input type="radio" name="correct_${stepIndex}" value="${optionIndex}" ${step.correct === optionIndex ? 'checked' : ''} class="option-radio">
                                                    <input type="text" class="option-input" name="option_${stepIndex}_${optionIndex}" value="${option}" placeholder="Option ${optionIndex + 1}" required>
                                                </div>
                                            `).join('')}
                                            
                                            <textarea class="form-textarea" name="explanation_${stepIndex}" placeholder="Explanation for correct answer" required>${step.explanation}</textarea>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 8px;">
                                <button type="submit" class="btn btn-primary" style="flex: 1;">üíæ Save Case</button>
                                <button type="button" class="btn btn-secondary" onclick="trainer.cancelEdit()">Cancel</button>
                            </div>
                        </form>
                    </div>
                `;
            }
            
            bindTrainerEvents() {
                // Events are bound through onclick attributes
            }
            
            bindAdminEvents() {
                // Events are bound through onclick attributes
            }
            
            addStep() {
                this.editingCase.steps.push({
                    question: "",
                    options: ["", "", "", ""],
                    correct: 0,
                    explanation: ""
                });
                this.render();
            }
            
            removeStep(stepIndex) {
                this.editingCase.steps.splice(stepIndex, 1);
                this.render();
            }
            
            handleFormSubmit(event) {
                event.preventDefault();
                const form = event.target;
                const formData = new FormData(form);
                
                const caseData = {
                    id: this.editingCase.id,
                    category: formData.get('category'),
                    urgency: formData.get('urgency'),
                    presentation: formData.get('presentation'),
                    vitals: formData.get('vitals'),
                    steps: []
                };
                
                // Parse steps
                const stepCount = this.editingCase.steps.length;
                for (let i = 0; i < stepCount; i++) {
                    const question = formData.get(`question_${i}`);
                    const options = [
                        formData.get(`option_${i}_0`),
                        formData.get(`option_${i}_1`),
                        formData.get(`option_${i}_2`),
                        formData.get(`option_${i}_3`)
                    ];
                    const correct = parseInt(formData.get(`correct_${i}`)) || 0;
                    const explanation = formData.get(`explanation_${i}`);
                    
                    caseData.steps.push({
                        question,
                        options,
                        correct,
                        explanation
                    });
                }
                
                this.saveCase(caseData);
            }
        }
        
        // Initialize the app
        let trainer;
        document.addEventListener('DOMContentLoaded', function() {
            trainer = new EmCaseTrainer();
        });
    </script>
</body>
</html>