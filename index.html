<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Briefcase</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 0; 
            padding: 0;
            background: #f8f9fa; 
            color: #333; 
        }
        .container { 
            max-width: 400px; 
            margin: 0 auto; 
            background: white; 
            min-height: 100vh; 
            position: relative;
        }
        .header { 
            background: #dc2626; 
            color: white; 
            padding: 16px; 
            position: sticky; 
            top: 0; 
            z-index: 10; 
        }
        .header-top { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 8px; 
        }
        .header-right {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .title { 
            font-size: 18px; 
            font-weight: bold; 
        }
        .score { 
            background: #991b1b; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 14px; 
        }
        .timer {
            background: #fef2f2;
            color: #dc2626;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .header-info { 
            font-size: 12px; 
            display: flex; 
            gap: 8px; 
            align-items: center; 
            flex-wrap: wrap;
        }
        .urgency { 
            padding: 3px 6px; 
            border-radius: 10px; 
            font-size: 11px; 
        }
        .urgency.high { 
            background: #fef2f2; 
            color: #dc2626; 
        }
        .urgency.medium { 
            background: #fefce8; 
            color: #ca8a04; 
        }
        .urgency.low { 
            background: #f0fdf4; 
            color: #16a34a; 
        }
        .content { 
            padding: 16px; 
        }
        .stats-panel {
            background: #f9fafb;
            padding: 14px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #e5e7eb;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }
        .stat-item {
            text-align: center;
            padding: 10px 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        .stat-value {
            font-size: 18px;
            font-weight: 600;
            color: #dc2626;
        }
        .stat-label {
            font-size: 11px;
            color: #6b7280;
            margin-top: 2px;
        }
        .category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 16px;
        }
        .filter-chip {
            padding: 6px 10px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid #e5e7eb;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        .filter-chip.active {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }
        .reset-stats {
            background: #ef4444;
            color: white;
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            margin-top: 8px;
            font-weight: 500;
        }
        .reset-stats:hover {
            background: #dc2626;
        }
        .case-header { 
            margin-bottom: 16px; 
        }
        .case-title { 
            font-size: 16px; 
            font-weight: 600; 
            margin-bottom: 8px; 
        }
        .presentation { 
            background: #f9fafb; 
            padding: 12px; 
            border-radius: 8px; 
            margin-bottom: 12px; 
            font-size: 14px; 
            line-height: 1.4; 
        }
        .vitals { 
            background: #eff6ff; 
            padding: 12px; 
            border-radius: 8px; 
        }
        .vitals-label { 
            font-size: 11px; 
            font-weight: 600; 
            color: #1e40af; 
            margin-bottom: 4px; 
        }
        .vitals-text { 
            font-size: 13px; 
            color: #1e40af; 
        }
        .progress { 
            display: flex; 
            gap: 6px; 
            margin-bottom: 16px; 
        }
        .progress-bar { 
            height: 6px; 
            flex: 1; 
            border-radius: 3px; 
            background: #e5e7eb; 
        }
        .progress-bar.active { 
            background: #dc2626; 
        }
        .question { 
            margin-bottom: 16px; 
        }
        .question-title { 
            font-weight: 500; 
            margin-bottom: 12px; 
            font-size: 15px;
        }
        .options { 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
        }
        .option { 
            width: 100%; 
            padding: 12px; 
            text-align: left; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            background: white; 
            cursor: pointer; 
            transition: all 0.2s; 
            font-size: 14px; 
            min-height: 44px;
            display: flex;
            align-items: center;
        }
        .option:hover:not(:disabled) { 
            background: #fef2f2; 
            border-color: #dc2626; 
        }
        .option.correct { 
            background: #f0fdf4; 
            border-color: #16a34a; 
            color: #15803d; 
        }
        .option.incorrect { 
            background: #fef2f2; 
            border-color: #dc2626; 
            color: #dc2626; 
        }
        .option.correct-answer { 
            background: #f0fdf4; 
            border-color: #16a34a; 
            color: #15803d; 
        }
        .option:disabled { 
            cursor: default; 
        }
        .explanation { 
            background: #eff6ff; 
            padding: 16px; 
            border-radius: 8px; 
            margin-bottom: 16px; 
        }
        .explanation-label { 
            font-size: 11px; 
            font-weight: 600; 
            color: #1e40af; 
            margin-bottom: 6px; 
        }
        .explanation-text { 
            font-size: 14px; 
            color: #1e40af; 
            line-height: 1.4; 
        }
        .actions { 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
        }
        .btn { 
            width: 100%; 
            padding: 14px; 
            border-radius: 8px; 
            border: none; 
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.2s; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 8px; 
            font-size: 15px;
        }
        .btn-primary { 
            background: #dc2626; 
            color: white; 
        }
        .btn-primary:hover { 
            background: #991b1b; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="app"></div>
    </div>

    <script>
        const defaultCases = [
            {
                id: 1,
                category: "Emergency Cardiology - STEMI",
                urgency: "high",
                presentation: "67M EMS arrival with crushing chest pain radiating to left arm and jaw. Started 45 min ago while watching TV. Diaphoretic, anxious, nauseous. PMH: HTN, DM, smoking 2ppd x30 years.",
                vitals: "BP: 160/95, HR: 102, RR: 22, O2: 96% RA, Temp: 98.6°F, Weight: 85kg",
                steps: [
                    { 
                        question: "EKG shows 4mm ST elevation V1-V4, reciprocal depression II/III/aVF. Door time 15min. ED priority?", 
                        options: ["Thrombolytics in ED", "Activate cath lab for primary PCI", "Medical management", "Emergent CABG consult"], 
                        correct: 1, 
                        explanation: "Emergency activation of cath lab for primary PCI. Door-to-balloon goal <90min for STEMI patients." 
                    },
                    { 
                        question: "Patient becomes hypotensive 80/40 with cool extremities. Immediate ED intervention?", 
                        options: ["IV fluid bolus", "Dopamine infusion", "Emergency bedside echo", "Intubation"], 
                        correct: 2, 
                        explanation: "Bedside echo to assess for mechanical complications (VSD, papillary muscle rupture, tamponade) in shock." 
                    }
                ]
            },
            {
                id: 19,
                category: "Emergency Gastroenterology - Lower GI Bleeding",
                urgency: "high",
                presentation: "68M presents with large volume bright red blood per rectum x2 hours. History of diverticulosis. Patient dizzy, pale, reports feeling weak. No abdominal pain currently.",
                vitals: "BP: 95/65, HR: 110, RR: 20, O2: 96% RA, Temp: 98.4°F",
                steps: [
                    {
                        question: "Most common cause of massive lower GI bleeding in elderly patients?",
                        options: ["Hemorrhoids", "Diverticulosis", "Inflammatory bowel disease", "Malignancy"],
                        correct: 1,
                        explanation: "Diverticulosis is the most common cause of massive lower GI bleeding in patients >60 years old."
                    },
                    {
                        question: "Initial ED management for massive lower GI bleeding?",
                        options: ["Immediate colonoscopy", "IV access + resuscitation + type and screen", "CT angiography", "Rectal exam only"],
                        correct: 1,
                        explanation: "Stabilization first: large bore IV access, fluid resuscitation, CBC, type and crossmatch before diagnostic procedures."
                    }
                ]
            },
            {
                id: 20,
                category: "Emergency Gastroenterology - Perforated Viscus",
                urgency: "high",
                presentation: "45M sudden onset severe abdominal pain while eating dinner. Pain is constant, worse with movement. PMH: peptic ulcer disease, taking NSAIDs daily. Patient appears ill, guarding abdomen.",
                vitals: "BP: 110/75, HR: 105, RR: 22, O2: 97% RA, Temp: 99.8°F",
                steps: [
                    {
                        question: "Classic imaging finding for perforated peptic ulcer?",
                        options: ["Bowel wall thickening", "Free air under diaphragm", "Fluid collection", "Bowel obstruction"],
                        correct: 1,
                        explanation: "Pneumoperitoneum (free air under diaphragm) is classic finding in perforated peptic ulcer on upright CXR."
                    },
                    {
                        question: "Immediate ED management for suspected perforation?",
                        options: ["IV PPI and discharge", "NPO + IV antibiotics + surgical consult", "Oral contrast study", "Antacids"],
                        correct: 1,
                        explanation: "Perforated viscus requires NPO, IV antibiotics, fluid resuscitation, and immediate surgical consultation."
                    }
                ]
            },
            {
                id: 21,
                category: "Emergency Endocrinology - Hyperosmolar Hyperglycemic State",
                urgency: "high",
                presentation: "72F brought by family for altered mental status x2 days. PMH: T2DM on metformin. Recently started prednisone for COPD exacerbation. Dehydrated, lethargic but arousable.",
                vitals: "BP: 100/70, HR: 115, RR: 24, O2: 94% RA, Temp: 98.2°F",
                steps: [
                    {
                        question: "Labs: Glucose 650, serum osmolality 350, minimal ketones. Most likely diagnosis?",
                        options: ["DKA", "Hyperosmolar hyperglycemic state (HHS)", "Diabetic coma", "Hypoglycemia"],
                        correct: 1,
                        explanation: "HHS: glucose >600, osmolality >320, minimal ketones, altered mental status. More common in T2DM."
                    },
                    {
                        question: "Key difference in HHS vs DKA fluid management?",
                        options: ["HHS needs more aggressive fluid replacement", "DKA needs more fluid", "No difference", "HHS patients can't tolerate fluids"],
                        correct: 0,
                        explanation: "HHS patients have greater fluid deficit (8-12L vs 5-7L in DKA) and need more aggressive replacement."
                    }
                ]
            },
            {
                id: 22,
                category: "Emergency Endocrinology - Adrenal Crisis",
                urgency: "high",
                presentation: "35F with known Addison's disease presents with severe weakness, nausea, vomiting x1 day. Ran out of prednisone 3 days ago. Appears ill, hypotensive, confused.",
                vitals: "BP: 75/45, HR: 130, RR: 26, O2: 96% RA, Temp: 99.6°F",
                steps: [
                    {
                        question: "Classic electrolyte abnormalities in adrenal crisis?",
                        options: ["Hypernatremia, hypokalemia", "Hyponatremia, hyperkalemia", "Normal electrolytes", "Hypercalcemia"],
                        correct: 1,
                        explanation: "Adrenal crisis: hyponatremia (aldosterone deficiency), hyperkalemia, hypoglycemia possible."
                    },
                    {
                        question: "Immediate ED treatment for suspected adrenal crisis?",
                        options: ["Wait for cortisol level", "Hydrocortisone 100mg IV immediately", "Oral prednisone", "Supportive care only"],
                        correct: 1,
                        explanation: "Don't delay! Give hydrocortisone 100mg IV immediately in suspected adrenal crisis. Can be life-saving."
                    }
                ]
            },
            {
                id: 23,
                category: "Emergency Endocrinology - Myxedema Coma",
                urgency: "high",
                presentation: "68F brought unconscious by family. Progressive lethargy x1 week. PMH: hypothyroidism, stopped taking levothyroxine. Bradycardic, hypothermic, non-pitting edema, delayed reflexes.",
                vitals: "BP: 90/60, HR: 45, RR: 8, O2: 88% RA, Temp: 94.2°F",
                steps: [
                    {
                        question: "Clinical presentation most concerning for myxedema coma?",
                        options: ["Tachycardia", "Hyperthermia", "Hypoventilation + hypothermia + altered mental status", "Hyperreflexia"],
                        correct: 2,
                        explanation: "Myxedema coma triad: hypothermia, hypoventilation (CO2 retention), altered mental status. High mortality."
                    },
                    {
                        question: "Emergency treatment for myxedema coma includes?",
                        options: ["Oral levothyroxine", "IV levothyroxine + liothyronine + hydrocortisone", "Supportive care only", "Warming blankets only"],
                        correct: 1,
                        explanation: "IV levothyroxine + liothyronine (T3) + hydrocortisone (possible adrenal insufficiency). Aggressive treatment needed."
                    }
                ]
            },
            {
                id: 24,
                category: "Emergency Hematology/Oncology - Tumor Lysis Syndrome",
                urgency: "high",
                presentation: "28M with newly diagnosed acute leukemia, day 2 after starting chemotherapy. Nausea, vomiting, decreased urine output, muscle cramps, altered mental status.",
                vitals: "BP: 125/85, HR: 95, RR: 18, O2: 97% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Classic lab abnormalities in tumor lysis syndrome?",
                        options: ["Hyperkalemia, hyperphosphatemia, hypocalcemia, hyperuricemia", "Hypokalemia, hypophosphatemia", "Normal labs", "Isolated hypernatremia"],
                        correct: 0,
                        explanation: "TLS: hyperkalemia, hyperphosphatemia, hypocalcemia, hyperuricemia from massive cell breakdown."
                    },
                    {
                        question: "Most life-threatening complication requiring immediate ED intervention?",
                        options: ["Hyperuricemia", "Hyperkalemia with cardiac arrhythmias", "Hypocalcemia", "Hyperphosphatemia"],
                        correct: 1,
                        explanation: "Hyperkalemia >6.0 can cause fatal arrhythmias. Needs immediate treatment with calcium, insulin/glucose, kayexalate."
                    }
                ]
            },
            {
                id: 25,
                category: "Emergency Hematology/Oncology - Hypercalcemia of Malignancy",
                urgency: "high",
                presentation: "62M with lung cancer presents with confusion, weakness, nausea x3 days. Family reports patient increasingly lethargic. PMH: squamous cell lung cancer with bone metastases.",
                vitals: "BP: 110/70, HR: 85, RR: 16, O2: 95% RA, Temp: 98.4°F",
                steps: [
                    {
                        question: "Most common cause of hypercalcemia in hospitalized patients?",
                        options: ["Primary hyperparathyroidism", "Malignancy", "Vitamin D toxicity", "Sarcoidosis"],
                        correct: 1,
                        explanation: "Malignancy is most common cause of hypercalcemia in hospitalized patients (PTH-rP or osteolytic lesions)."
                    },
                    {
                        question: "First-line ED treatment for severe hypercalcemia (Ca >14 mg/dL)?",
                        options: ["Calcitonin", "Normal saline hydration", "Bisphosphonates", "Dialysis"],
                        correct: 1,
                        explanation: "IV normal saline first-line for severe hypercalcemia. Promotes calcium excretion. Then calcitonin, bisphosphonates."
                    }
                ]
            },
            {
                id: 26,
                category: "Emergency Hematology/Oncology - Superior Vena Cava Syndrome",
                urgency: "medium",
                presentation: "55M with lung cancer presents with facial swelling, neck swelling, dyspnea x1 week. Worse when lying flat. Visible distended veins on chest wall.",
                vitals: "BP: 130/80, HR: 95, RR: 22, O2: 92% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Classic findings in superior vena cava syndrome?",
                        options: ["Lower extremity edema", "Facial/neck swelling + chest wall collaterals", "Ascites", "Pulmonary edema"],
                        correct: 1,
                        explanation: "SVC syndrome: facial/neck swelling, upper extremity edema, chest wall collateral veins, worse supine."
                    },
                    {
                        question: "Most appropriate initial ED management?",
                        options: ["Immediate radiation therapy", "Elevate head of bed + dexamethasone", "Thrombolytics", "Surgical decompression"],
                        correct: 1,
                        explanation: "Conservative management: elevate head of bed, avoid supine position. Dexamethasone for symptomatic relief."
                    }
                ]
            },
            {
                id: 27,
                category: "Emergency Otolaryngology - Acute Epiglottitis",
                urgency: "high",
                presentation: "42M severe sore throat, difficulty swallowing, muffled voice, drooling. Sitting upright, leaning forward. Fever, appears toxic. No cough or URI symptoms.",
                vitals: "BP: 120/80, HR: 110, RR: 24, O2: 93% RA, Temp: 102.4°F",
                steps: [
                    {
                        question: "Classic positioning in epiglottitis?",
                        options: ["Lying flat", "Sitting upright, leaning forward (sniffing position)", "Side-lying", "Trendelenburg"],
                        correct: 1,
                        explanation: "Epiglottitis: patient sits upright, leans forward, extends neck (sniffing position) to maximize airway opening."
                    },
                    {
                        question: "Most important ED management principle?",
                        options: ["Immediate intubation", "Avoid airway manipulation until OR ready", "Throat examination with tongue blade", "Nebulizer treatments"],
                        correct: 1,
                        explanation: "Avoid airway manipulation! Can precipitate complete obstruction. Have OR and surgical airway ready."
                    }
                ]
            },
            {
                id: 28,
                category: "Emergency Otolaryngology - Peritonsillar Abscess",
                urgency: "medium",
                presentation: "25M severe throat pain x3 days, worse on right side. Difficulty swallowing, muffled voice, fever. Right tonsillar swelling with uvular deviation to left.",
                vitals: "BP: 125/75, HR: 95, RR: 18, O2: 96% RA, Temp: 101.6°F",
                steps: [
                    {
                        question: "Physical exam finding pathognomonic for peritonsillar abscess?",
                        options: ["Bilateral tonsillar swelling", "Uvular deviation away from affected side", "Normal throat exam", "Posterior pharyngeal swelling"],
                        correct: 1,
                        explanation: "Peritonsillar abscess: unilateral tonsillar swelling pushes uvula away from affected side. Classic finding."
                    },
                    {
                        question: "Definitive ED treatment for peritonsillar abscess?",
                        options: ["Antibiotics only", "Needle aspiration or I&D", "Steroids", "Throat lozenges"],
                        correct: 1,
                        explanation: "Needle aspiration or incision and drainage is definitive treatment. Provides immediate relief and drainage."
                    }
                ]
            },
            {
                id: 29,
                category: "Emergency Otolaryngology - Acute Hearing Loss",
                urgency: "medium",
                presentation: "45F sudden onset complete hearing loss in right ear this morning. No trauma, no pain. Some tinnitus and mild dizziness. No recent URI or ototoxic medications.",
                vitals: "BP: 130/80, HR: 80, RR: 16, O2: 98% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Most likely diagnosis for sudden unilateral sensorineural hearing loss?",
                        options: ["Cerumen impaction", "Acoustic neuroma", "Sudden sensorineural hearing loss (SSNHL)", "Otitis media"],
                        correct: 2,
                        explanation: "Sudden sensorineural hearing loss: idiopathic, sudden onset (usually <72hrs), unilateral, may have tinnitus."
                    },
                    {
                        question: "Time-sensitive ED treatment for sudden sensorineural hearing loss?",
                        options: ["Ear irrigation", "High-dose corticosteroids", "Antibiotics", "Observation only"],
                        correct: 1,
                        explanation: "High-dose corticosteroids within 72 hours (ideally within 24 hours) can improve hearing recovery."
                    }
                ]
            },
            {
                id: 30,
                category: "Emergency Otolaryngology - Epistaxis (Severe)",
                urgency: "high",
                presentation: "68M on warfarin presents with profuse nosebleed x2 hours. Unable to control with pressure. Blood trickling down throat. PMH: atrial fibrillation, HTN.",
                vitals: "BP: 165/95, HR: 105, RR: 18, O2: 96% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "Most common location for severe epistaxis in adults?",
                        options: ["Anterior septum (Kiesselbach's plexus)", "Posterior nasal cavity (sphenopalatine artery)", "Superior turbinate", "External nares"],
                        correct: 1,
                        explanation: "Severe epistaxis in adults usually posterior (sphenopalatine artery), especially in elderly with HTN."
                    },
                    {
                        question: "After failed anterior packing, next ED intervention?",
                        options: ["Discharge home", "Posterior nasal packing or balloon", "Oral antibiotics", "ENT follow-up only"],
                        correct: 1,
                        explanation: "Failed anterior packing suggests posterior bleed. Needs posterior packing/balloon and ENT consultation."
                    }
                ]
            },
            {
                id: 2,
                category: "Emergency Pulmonology - Massive PE",
                urgency: "high",
                presentation: "52M EMS Code Blue at airport customs after 14-hour flight. Witnessed collapse, CPR started. ROSC achieved. PMH: Factor V Leiden, recent knee surgery 3 weeks ago.",
                vitals: "BP: 75/45, HR: 135, RR: 32, O2: 78% on 15L NRB, Temp: 98.2°F",
                steps: [
                    { 
                        question: "Hemodynamically unstable suspected massive PE. ED priority assessment?", 
                        options: ["STAT CT angiogram", "Bedside echocardiogram", "D-dimer level", "Arterial blood gas"], 
                        correct: 1, 
                        explanation: "Bedside echo immediately assesses RV strain in unstable patient. Don't delay care for CT in shock." 
                    },
                    { 
                        question: "Echo shows severe RV strain. Recent surgery 3 weeks ago. ED thrombolysis decision?", 
                        options: ["Absolute contraindication", "Benefits outweigh risks - give tPA", "Wait for surgery consult", "Give half-dose tPA"], 
                        correct: 1, 
                        explanation: "Massive PE with cardiac arrest may justify thrombolysis despite recent surgery in ED setting." 
                    }
                ]
            },
            {
                id: 3,
                category: "Emergency Neurology - Status Epilepticus",
                urgency: "high",
                presentation: "32M brought by EMS for ongoing generalized seizure x15 minutes. No IV access established. PMH: epilepsy on phenytoin. Wife reports recent medication non-compliance.",
                vitals: "BP: 160/95, HR: 120, RR: 24, O2: 90% on NRB, Temp: 99.8°F",
                steps: [
                    { 
                        question: "Active seizure x15 minutes, no IV. Immediate ED intervention?", 
                        options: ["Establish IV access first", "IM midazolam 10mg", "Rectal diazepam", "Wait for IV access"], 
                        correct: 1, 
                        explanation: "IM midazolam is first-line for status epilepticus without IV access in ED. Don't delay for IV." 
                    },
                    { 
                        question: "IM midazolam given, seizure continues. IV now established. Next ED medication?", 
                        options: ["Lorazepam 4mg IV", "Diazepam 10mg IV", "Phenytoin loading dose", "Keppra 2g IV"], 
                        correct: 0, 
                        explanation: "Lorazepam 0.1mg/kg IV is preferred second-line agent for refractory status epilepticus in ED." 
                    }
                ]
            },
            {
                id: 4,
                category: "Emergency Medicine - Anaphylaxis",
                urgency: "high",
                presentation: "28F brought by EMS 15 minutes post bee sting. Rapidly developing generalized urticaria, facial swelling, wheezing, sense of 'impending doom'.",
                vitals: "BP: 85/55, HR: 130, RR: 28, O2: 88% RA, Temp: 98.6°F",
                steps: [
                    { 
                        question: "Multi-system involvement confirms anaphylaxis. Which systems affected?", 
                        options: ["Skin + respiratory only", "Cardiovascular + respiratory only", "Skin + cardiovascular + respiratory", "GI + respiratory only"], 
                        correct: 2, 
                        explanation: "Skin (urticaria, angioedema), respiratory (wheezing), cardiovascular (hypotension) = anaphylaxis." 
                    },
                    { 
                        question: "First-line ED treatment for anaphylaxis?", 
                        options: ["Diphenhydramine 50mg IV", "Albuterol nebulizer", "Epinephrine 0.3mg IM", "Methylprednisolone"], 
                        correct: 2, 
                        explanation: "Epinephrine IM is first-line. Give immediately - don't delay for IV access or other meds." 
                    }
                ]
            },
            {
                id: 5,
                category: "Emergency Toxicology - Acetaminophen Overdose",
                urgency: "high",
                presentation: "19F brought by friends after intentional ingestion. Empty acetaminophen bottle found. Estimated 8g ingested 6 hours ago. Currently asymptomatic.",
                vitals: "BP: 120/75, HR: 88, RR: 16, O2: 98% RA, Temp: 98.4°F",
                steps: [
                    { 
                        question: "ED acetaminophen level 6 hours post-ingestion: 180 μg/mL. Rumack-Matthew interpretation?", 
                        options: ["Below treatment line", "Above treatment line - needs NAC", "Level too early", "Nomogram invalid"], 
                        correct: 1, 
                        explanation: "180 μg/mL at 6 hours is above treatment line (150 μg/mL). High hepatotoxicity risk." 
                    },
                    { 
                        question: "ED NAC (N-acetylcysteine) administration timing?", 
                        options: ["Most effective within 8 hours", "Equally effective anytime", "Only effective within 4 hours", "No time limit"], 
                        correct: 0, 
                        explanation: "NAC most effective within 8 hours. Still beneficial up to 24 hours but decreasing efficacy." 
                    }
                ]
            },
            {
                id: 6,
                category: "Emergency Infectious Disease - Septic Shock",
                urgency: "high",
                presentation: "68F EMS transport from nursing home for altered mental status and hypotension. Foley catheter x2 weeks, cloudy malodorous urine. PMH: DM, dementia.",
                vitals: "BP: 78/45, HR: 120, RR: 28, O2: 90% RA, Temp: 101.8°F, Lactate: 4.2",
                steps: [
                    { 
                        question: "qSOFA score: altered mental status (1), SBP <100 (1), RR ≥22 (1). ED significance?", 
                        options: ["qSOFA 2, low mortality risk", "qSOFA 3, high mortality risk", "qSOFA irrelevant in ED", "Need full SOFA score"], 
                        correct: 1, 
                        explanation: "qSOFA ≥2 predicts high mortality. This patient scores 3 - immediate sepsis protocol in ED." 
                    },
                    { 
                        question: "ED sepsis hour-1 bundle priorities?", 
                        options: ["Lactate only", "Blood cultures then antibiotics", "30ml/kg fluids + broad antibiotics", "All: lactate, cultures, antibiotics, fluids"], 
                        correct: 3, 
                        explanation: "Hour-1 bundle: measure lactate, obtain cultures, give antibiotics, fluid resuscitation." 
                    }
                ]
            },
            {
                id: 7,
                category: "Emergency Orthopedics - Compartment Syndrome",
                urgency: "high",
                presentation: "25M motorcycle trauma with closed tibia fracture 4 hours ago. Severe pain despite morphine and fracture reduction. Pain with passive toe flexion.",
                vitals: "BP: 125/80, HR: 95, RR: 18, O2: 97% RA, Temp: 98.6°F",
                steps: [
                    { 
                        question: "Most sensitive early ED finding for compartment syndrome?", 
                        options: ["Absent distal pulses", "Pain out of proportion to injury", "Paresthesias", "Paralysis"], 
                        correct: 1, 
                        explanation: "Pain out of proportion to injury, especially with passive stretch, is earliest finding in ED." 
                    },
                    { 
                        question: "ED compartment pressure 45mmHg, diastolic BP 80mmHg. Action needed?", 
                        options: ["Normal pressure", "Borderline - recheck", "Delta pressure 35mmHg - emergent fasciotomy", "Pain control only"], 
                        correct: 2, 
                        explanation: "Delta pressure = diastolic BP - compartment pressure. <30mmHg = surgical emergency." 
                    }
                ]
            },
            {
                id: 8,
                category: "Emergency Pediatrics - Febrile Seizure",
                urgency: "medium",
                presentation: "18-month-old M brought by EMS after witnessed 3-minute generalized seizure at home. Child febrile x2 days with URI symptoms. No previous seizures.",
                vitals: "BP: 95/60, HR: 140, RR: 28, O2: 98% RA, Temp: 103.2°F, Weight: 12kg",
                steps: [
                    { 
                        question: "ED criteria for simple vs complex febrile seizure. Complex includes?", 
                        options: ["Duration >15 minutes", "Age <6 months", "Focal features", "All of the above"], 
                        correct: 3, 
                        explanation: "Complex febrile seizure: >15min duration, focal features, age <6mo or >5yr, or recurs in 24hr." 
                    },
                    { 
                        question: "ED workup for first simple febrile seizure in 18-month-old?", 
                        options: ["Lumbar puncture mandatory", "CT head", "Focus on identifying fever source", "EEG"], 
                        correct: 2, 
                        explanation: "Simple febrile seizures don't require LP, imaging, or EEG. Focus on fever source in ED." 
                    }
                ]
            },
            {
                id: 9,
                category: "Emergency Environmental - Heat Stroke",
                urgency: "high",
                presentation: "55M EMS transport after collapse at mile 20 of marathon. Hot, dry skin, altered mental status, ataxic. Ambient 95°F, high humidity.",
                vitals: "BP: 90/55, HR: 150, RR: 35, O2: 94% RA, Temp: 107.2°F",
                steps: [
                    { 
                        question: "ED heat stroke classification: classic vs exertional prognosis?", 
                        options: ["Classic worse prognosis", "Exertional worse prognosis", "Equal prognosis", "Age-dependent only"], 
                        correct: 0, 
                        explanation: "Classic heat stroke (elderly, chronic illness) has higher mortality than exertional heat stroke." 
                    },
                    { 
                        question: "Most effective ED cooling method for heat stroke?", 
                        options: ["Ice packs only", "Cold water immersion", "Evaporative cooling", "IV cooling"], 
                        correct: 1, 
                        explanation: "Cold water immersion most effective. If unavailable, evaporative cooling (fans + mist)." 
                    }
                ]
            },
            {
                id: 10,
                category: "Emergency OB/GYN - Ruptured Ectopic",
                urgency: "high",
                presentation: "28F ED presentation with severe lower abdominal pain and syncope. LMP 6 weeks ago. Sudden onset while exercising. Pale, diaphoretic, tachycardic.",
                vitals: "BP: 85/50, HR: 125, RR: 24, O2: 96% RA, Temp: 98.6°F",
                steps: [
                    { 
                        question: "Hemodynamically unstable female of reproductive age. ED priority assessment?", 
                        options: ["Quantitative beta-hCG", "Transvaginal ultrasound", "FAST exam", "Pelvic exam"], 
                        correct: 2, 
                        explanation: "FAST exam rapidly detects hemoperitoneum in unstable patient. Don't delay for formal imaging." 
                    },
                    { 
                        question: "FAST positive for free fluid, unstable vitals. ED management?", 
                        options: ["Pelvic ultrasound", "Type and crossmatch + OR", "Discharge home", "IV fluids only"], 
                        correct: 1, 
                        explanation: "Unstable ectopic with hemoperitoneum needs immediate surgical intervention. Activate OR from ED." 
                    }
                ]
            },
            {
                id: 11,
                category: "Emergency Trauma - Hemorrhagic Shock",
                urgency: "high",
                presentation: "22M motorcycle vs car at 50mph. Trauma activation called. Patient alert but pale, tachycardic. Obvious deformed left femur, abdominal distension. Mechanism suggests high energy trauma.",
                vitals: "BP: 90/60, HR: 130, RR: 28, O2: 94% on 15L NRB, Temp: 97.2°F",
                steps: [
                    {
                        question: "Primary survey reveals tachycardia, hypotension, distended abdomen. Most likely class of hemorrhagic shock?",
                        options: ["Class I (<15% blood loss)", "Class II (15-30% blood loss)", "Class III (30-40% blood loss)", "Class IV (>40% blood loss)"],
                        correct: 2,
                        explanation: "Tachycardia >120, hypotension, and altered mental status suggest Class III shock (30-40% blood loss, 1500-2000mL)."
                    },
                    {
                        question: "FAST exam shows free fluid in abdomen. Unstable vitals persist after 2L crystalloid. Next priority?",
                        options: ["CT scan of abdomen", "Emergent laparotomy", "More IV fluids", "Blood type and crossmatch"],
                        correct: 1,
                        explanation: "Unstable patient with positive FAST and ongoing shock after initial resuscitation needs immediate surgical control of bleeding."
                    }
                ]
            },
            {
                id: 12,
                category: "Emergency Trauma - Penetrating Chest",
                urgency: "high",
                presentation: "28M GSW to right chest. EMS reports entry wound 5th intercostal space, anterior axillary line. Patient conscious, severe SOB. No exit wound visualized.",
                vitals: "BP: 85/50, HR: 140, RR: 35, O2: 85% on NRB, Temp: 98.4°F",
                steps: [
                    {
                        question: "Penetrating injury to 'Box' (cardiac silhouette on CXR). Most concerning complication?",
                        options: ["Pneumothorax", "Cardiac tamponade", "Hemothorax", "Pulmonary contusion"],
                        correct: 1,
                        explanation: "Penetrating injury to cardiac box requires evaluation for pericardial tamponade - Beck's triad: hypotension, JVD, muffled heart sounds."
                    },
                    {
                        question: "Bedside echo shows pericardial effusion with RV collapse. Immediate intervention?",
                        options: ["Chest tube insertion", "Pericardiocentesis", "Emergency thoracotomy", "IV fluid bolus"],
                        correct: 2,
                        explanation: "Penetrating cardiac injury with tamponade in unstable patient requires emergency thoracotomy for cardiac repair."
                    }
                ]
            },
            {
                id: 13,
                category: "Emergency Trauma - Traumatic Brain Injury",
                urgency: "high",
                presentation: "45M fall from 20 feet onto concrete. Found unconscious, now opens eyes to pain, inappropriate words, localizes to pain. Pupils 3mm reactive bilaterally.",
                vitals: "BP: 160/90, HR: 65, RR: 12, O2: 96% RA, Temp: 98.6°F",
                steps: [
                    {
                        question: "GCS calculation: Eyes open to pain (2) + inappropriate words (3) + localizes (5) = ?",
                        options: ["GCS 8 - severe TBI", "GCS 10 - moderate TBI", "GCS 12 - mild TBI", "GCS 15 - normal"],
                        correct: 1,
                        explanation: "GCS 10 = moderate TBI. GCS 9-12 is moderate, 3-8 severe, 13-15 mild traumatic brain injury."
                    },
                    {
                        question: "Hypertension + bradycardia in head injury patient suggests?",
                        options: ["Spinal shock", "Hemorrhagic shock", "Cushing's triad - increased ICP", "Neurogenic shock"],
                        correct: 2,
                        explanation: "Cushing's triad: hypertension, bradycardia, irregular respirations indicates increased intracranial pressure."
                    }
                ]
            },
            {
                id: 14,
                category: "Emergency Trauma - Cervical Spine Injury",
                urgency: "high",
                presentation: "19M diving accident in shallow water. C-spine immobilized by EMS. Patient awake, reports neck pain and bilateral arm numbness/weakness. Able to move legs normally.",
                vitals: "BP: 85/55, HR: 55, RR: 16, O2: 98% RA, Temp: 97.8°F",
                steps: [
                    {
                        question: "Hypotension + bradycardia + normal leg movement with arm weakness suggests?",
                        options: ["Hemorrhagic shock", "Neurogenic shock from C-spine injury", "Cardiogenic shock", "Spinal shock"],
                        correct: 1,
                        explanation: "Neurogenic shock: loss of sympathetic tone causing hypotension/bradycardia. C5-C6 injury affects arms but spares legs."
                    },
                    {
                        question: "Management of neurogenic shock in C-spine injury?",
                        options: ["Large volume crystalloid", "Vasopressors (phenylephrine)", "Both fluids and vasopressors", "Atropine only"],
                        correct: 2,
                        explanation: "Neurogenic shock requires both judicious fluids (avoid overload) and vasopressors to restore vascular tone."
                    }
                ]
            },
            {
                id: 15,
                category: "Emergency Gastroenterology - Upper GI Bleeding",
                urgency: "high",
                presentation: "56M with cirrhosis presents with massive hematemesis and melena. Found confused and pale by family. PMH: cirrhosis, known varices, Child-Pugh B classification.",
                vitals: "BP: 85/55, HR: 125, RR: 24, O2: 92% RA, Temp: 98.8°F, Hgb: 6.2",
                steps: [
                    {
                        question: "Rockall score pre-endoscopy: Age 56 (1) + shock (2) + comorbidity (1) = 4. Significance?",
                        options: ["Low risk, outpatient management", "Moderate risk, observation", "High risk, urgent endoscopy", "Maximum risk score"],
                        correct: 2,
                        explanation: "Rockall score ≥3 indicates high risk for rebleeding and mortality. Requires urgent endoscopy and ICU monitoring."
                    },
                    {
                        question: "Hemoglobin 6.2 in cirrhotic patient with variceal bleeding. ED transfusion strategy?",
                        options: ["Transfuse to Hgb >10", "Restrictive strategy Hgb 7-9", "No transfusion needed", "Massive transfusion protocol"],
                        correct: 1,
                        explanation: "Restrictive transfusion (Hgb 7-9) in variceal bleeding reduces portal pressure and rebleeding risk."
                    }
                ]
            },
            {
                id: 16,
                category: "Emergency Gastroenterology - Acute Pancreatitis",
                urgency: "medium",
                presentation: "42F severe epigastric pain radiating to back x6 hours. Nausea, vomiting after large meal. PMH: gallstones. Pain 9/10, patient writhing in pain.",
                vitals: "BP: 110/70, HR: 105, RR: 20, O2: 96% RA, Temp: 100.4°F",
                steps: [
                    {
                        question: "ED labs: lipase 850, ALT 245, bilirubin 3.2. Most likely etiology?",
                        options: ["Alcohol-induced", "Gallstone pancreatitis", "Idiopathic", "Drug-induced"],
                        correct: 1,
                        explanation: "Elevated ALT >150 and bilirubin strongly suggest gallstone etiology. Classic triad: gallstones + elevated ALT + bilirubin."
                    },
                    {
                        question: "BISAP score assessment includes all EXCEPT?",
                        options: ["BUN >25", "Impaired mental status", "SIRS criteria", "Lipase level"],
                        correct: 3,
                        explanation: "BISAP: BUN >25, Impaired mental status, SIRS, Age >60, Pleural effusion. Lipase level not included."
                    }
                ]
            },
            {
                id: 17,
                category: "Emergency Gastroenterology - Small Bowel Obstruction",
                urgency: "medium",
                presentation: "65M presents with crampy abdominal pain, vomiting, and inability to pass gas x24 hours. PMH: appendectomy 20 years ago. Abdomen distended with high-pitched bowel sounds.",
                vitals: "BP: 125/80, HR: 95, RR: 18, O2: 97% RA, Temp: 99.2°F",
                steps: [
                    {
                        question: "Classic triad of small bowel obstruction includes?",
                        options: ["Pain, vomiting, constipation", "Pain, distension, vomiting", "Vomiting, distension, obstipation", "All of the above"],
                        correct: 3,
                        explanation: "SBO triad: colicky abdominal pain, vomiting, obstipation (inability to pass gas/stool). Distension often present."
                    },
                    {
                        question: "CT shows dilated small bowel with transition point. No signs of strangulation. Management?",
                        options: ["Immediate surgery", "NG decompression + conservative management", "Discharge home", "Colonoscopy"],
                        correct: 1,
                        explanation: "Partial SBO without strangulation: NG decompression, IV fluids, NPO. Surgery if no improvement in 24-48hrs."
                    }
                ]
            },
            {
                id: 18,
                category: "Emergency Gastroenterology - Acute Cholangitis",
                urgency: "high",
                presentation: "72F presents with fever, jaundice, and RUQ pain x12 hours. Recently had ERCP 1 week ago. Appears ill, rigors noted. Dark urine, clay-colored stools.",
                vitals: "BP: 95/60, HR: 115, RR: 22, O2: 95% RA, Temp: 102.8°F",
                steps: [
                    {
                        question: "Charcot's triad present: fever + jaundice + RUQ pain. Addition of hypotension + altered mental status = ?",
                        options: ["Complicated cholecystitis", "Reynolds pentad - severe cholangitis", "Acute pancreatitis", "Septic shock"],
                        correct: 1,
                        explanation: "Reynolds pentad = Charcot's triad + hypotension + altered mental status. Indicates severe suppurative cholangitis."
                    },
                    {
                        question: "Most appropriate immediate ED management for acute cholangitis?",
                        options: ["Antibiotics only", "ERCP within 6 hours", "IV antibiotics + urgent biliary decompression", "Surgery consult"],
                        correct: 2,
                        explanation: "Acute cholangitis requires immediate IV antibiotics AND urgent biliary decompression (ERCP or PTC)."
                    }
                ]
            }
        ];

        class EmCaseTrainer {
            constructor() {
                this.currentCase = 0;
                this.step = 0;
                this.selectedAnswers = {};
                this.showExplanation = false;
                this.score = { correct: 0, total: 0 };
                this.sessionStats = this.loadSessionStats();
                this.currentFilter = 'all';
                this.questionTimer = Date.now();
                this.render();
            }

            loadSessionStats() {
                if (!this.memoryStats) {
                    this.memoryStats = {
                        totalQuestions: 0,
                        correctAnswers: 0,
                        categoryStats: {},
                        averageTime: 0,
                        longestStreak: 0,
                        currentStreak: 0
                    };
                }
                return this.memoryStats;
            }

            saveSessionStats() {
                this.memoryStats = { ...this.sessionStats };
            }

            resetStats() {
                this.sessionStats = {
                    totalQuestions: 0,
                    correctAnswers: 0,
                    categoryStats: {},
                    averageTime: 0,
                    longestStreak: 0,
                    currentStreak: 0
                };
                this.score = { correct: 0, total: 0 };
                this.memoryStats = { ...this.sessionStats };
                this.render();
            }

            getFilteredCases() {
                if (this.currentFilter === 'all') return defaultCases;
                return defaultCases.filter(c => c.category.toLowerCase().includes(this.currentFilter.toLowerCase()));
            }

            getCategories() {
                const categories = [...new Set(defaultCases.map(c => c.category.split(' - ')[0]))];
                return ['all', ...categories.sort()];
            }
            
            getCurrentCase() { 
                const filteredCases = this.getFilteredCases();
                return filteredCases[this.currentCase] || null; 
            }
            
            getCurrentStep() { 
                const currentCase = this.getCurrentCase(); 
                return currentCase && currentCase.steps ? currentCase.steps[this.step] : null; 
            }
            
            handleAnswer(answerIndex) {
                const key = `${this.currentCase}-${this.step}`;
                this.selectedAnswers[key] = answerIndex;
                const step = this.getCurrentStep();
                const currentCase = this.getCurrentCase();
                
                if (!step || !currentCase) return;
                
                const isCorrect = answerIndex === step.correct;
                const questionTime = (Date.now() - this.questionTimer) / 1000;
                
                this.sessionStats.totalQuestions++;
                if (isCorrect) {
                    this.sessionStats.correctAnswers++;
                    this.sessionStats.currentStreak++;
                    if (this.sessionStats.currentStreak > this.sessionStats.longestStreak) {
                        this.sessionStats.longestStreak = this.sessionStats.currentStreak;
                    }
                } else {
                    this.sessionStats.currentStreak = 0;
                }
                
                const category = currentCase.category.split(' - ')[0];
                if (!this.sessionStats.categoryStats[category]) {
                    this.sessionStats.categoryStats[category] = { correct: 0, total: 0 };
                }
                this.sessionStats.categoryStats[category].total++;
                if (isCorrect) {
                    this.sessionStats.categoryStats[category].correct++;
                }
                
                this.sessionStats.averageTime = ((this.sessionStats.averageTime * (this.sessionStats.totalQuestions - 1)) + questionTime) / this.sessionStats.totalQuestions;
                
                if (isCorrect) {
                    this.score.correct++;
                }
                this.score.total++;
                this.showExplanation = true;
                this.saveSessionStats();
                this.render();
            }
            
            nextStep() {
                const filteredCases = this.getFilteredCases();
                const currentCase = this.getCurrentCase();
                if (!currentCase) return;
                
                if (this.step < currentCase.steps.length - 1) {
                    this.step++;
                } else {
                    this.nextCase();
                }
                this.showExplanation = false;
                this.questionTimer = Date.now();
                this.render();
            }
            
            nextCase() {
                const filteredCases = this.getFilteredCases();
                if (this.currentCase < filteredCases.length - 1) {
                    this.currentCase++;
                    this.step = 0;
                } else {
                    this.currentCase = 0;
                    this.step = 0;
                }
                this.showExplanation = false;
                this.questionTimer = Date.now();
                this.render();
            }

            setFilter(filter) {
                this.currentFilter = filter;
                this.currentCase = 0;
                this.step = 0;
                this.showExplanation = false;
                this.questionTimer = Date.now();
                this.render();
            }
            
            render() {
                const app = document.getElementById('app');
                const currentCase = this.getCurrentCase();
                const currentStep = this.getCurrentStep();
                
                if (!currentCase) {
                    app.innerHTML = '<div class="content"><p>No cases available for the selected filter</p></div>';
                    return;
                }
                
                app.innerHTML = this.renderCase(currentCase, currentStep);
            }

            renderStats() {
                const accuracy = this.sessionStats.totalQuestions > 0 ? 
                    Math.round((this.sessionStats.correctAnswers / this.sessionStats.totalQuestions) * 100) : 0;
                
                return `
                    <div class="stats-panel">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">${accuracy}%</div>
                                <div class="stat-label">Accuracy</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${this.sessionStats.totalQuestions}</div>
                                <div class="stat-label">Questions</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${this.sessionStats.longestStreak}</div>
                                <div class="stat-label">Best Streak</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${Math.round(this.sessionStats.averageTime)}s</div>
                                <div class="stat-label">Avg Time</div>
                            </div>
                        </div>
                        <button class="reset-stats" onclick="app.resetStats()">Reset Session Stats</button>
                    </div>
                `;
            }

            renderFilters() {
                const categories = this.getCategories();
                return `
                    <div class="category-filter">
                        ${categories.map(cat => `
                            <button class="filter-chip ${this.currentFilter === cat ? 'active' : ''}" 
                                    onclick="app.setFilter('${cat}')">
                                ${cat === 'all' ? `All Cases (${defaultCases.length})` : cat.replace('Emergency ', '')}
                            </button>
                        `).join('')}
                    </div>
                `;
            }
            
            renderCase(currentCase, currentStep) {
                const filteredCases = this.getFilteredCases();
                const progressBars = currentCase.steps.map((_, i) => 
                    `<div class="progress-bar ${i <= this.step ? 'active' : ''}"></div>`
                ).join('');
                
                const selectedAnswer = this.selectedAnswers[`${this.currentCase}-${this.step}`];
                const questionTime = Math.round((Date.now() - this.questionTimer) / 1000);
                
                const options = currentStep ? currentStep.options.map((option, i) => {
                    let className = 'option';
                    if (this.showExplanation) {
                        if (i === currentStep.correct) className += ' correct-answer';
                        if (i === selectedAnswer && i !== currentStep.correct) className += ' incorrect';
                        if (i === selectedAnswer && i === currentStep.correct) className += ' correct';
                    }
                    
                    return `
                        <button class="${className}" 
                                onclick="app.handleAnswer(${i})" 
                                ${this.showExplanation ? 'disabled' : ''}>
                            ${option}
                        </button>
                    `;
                }).join('') : '';
                
                const explanation = this.showExplanation && currentStep ? `
                    <div class="explanation">
                        <div class="explanation-label">EXPLANATION</div>
                        <div class="explanation-text">${currentStep.explanation}</div>
                    </div>
                ` : '';
                
                const actions = this.showExplanation ? `
                    <div class="actions">
                        <button class="btn btn-primary" onclick="app.nextStep()">
                            ${this.step < currentCase.steps.length - 1 ? 'Next Question' : 'Next Case'}
                        </button>
                    </div>
                ` : '';
                
                return `
                    <div class="header">
                        <div class="header-top">
                            <div class="title">Emergency Briefcase</div>
                            <div class="header-right">
                                <div class="timer">${questionTime}s</div>
                                <div class="score">${this.score.correct}/${this.score.total}</div>
                            </div>
                        </div>
                        <div class="header-info">
                            <span>Case ${this.currentCase + 1}/${filteredCases.length}</span>
                            <span class="urgency ${currentCase.urgency}">${currentCase.urgency.toUpperCase()}</span>
                            <span>Step ${this.step + 1}/${currentCase.steps.length}</span>
                            <span>Streak: ${this.sessionStats.currentStreak}</span>
                        </div>
                    </div>
                    
                    <div class="content">
                        ${this.renderStats()}
                        ${this.renderFilters()}
                        
                        <div class="case-header">
                            <div class="case-title">${currentCase.category}</div>
                            <div class="presentation">${currentCase.presentation}</div>
                            <div class="vitals">
                                <div class="vitals-label">VITAL SIGNS</div>
                                <div class="vitals-text">${currentCase.vitals}</div>
                            </div>
                        </div>
                        
                        <div class="progress">${progressBars}</div>
                        
                        ${currentStep ? `
                            <div class="question">
                                <div class="question-title">${currentStep.question}</div>
                                <div class="options">${options}</div>
                            </div>
                        ` : ''}
                        
                        ${explanation}
                        ${actions}
                    </div>
                `;
            }
        }
        
        const app = new EmCaseTrainer();
        window.app = app;
    </script>
</body>
</html>